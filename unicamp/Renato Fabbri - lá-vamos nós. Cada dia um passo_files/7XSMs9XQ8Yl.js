/*!CK:1981537405!*//*1436883056,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["nL4VQ"]); }

__d("MercurySpoofWarning.react",["MercuryParticipants","React","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=h,k=j.PropTypes,l=h.createClass({displayName:"MercurySpoofWarning",propTypes:{authorID:k.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(m){g.get(m.authorID,function(n){return this.setState({author:n});}.bind(this));},render:function(){return (h.createElement("div",h.__spread({},this.props),i._("{name_or_email} kann nicht als Absender best\u00e4tigt werden.",[i.param("name_or_email",this.state.author.name)])));}});e.exports=l;},null);
__d("MercuryTypingIndicator",["Animation","BootloadedComponent.react","ChatConfig","DOM","JSResource","MercuryViewer","MercuryParticipants","React","Style","ChatTabTemplates","Tooltip","csx","cx","fbt","MercuryTypingReceiver","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryTypingReceiver').get(),v=b('MercuryThreadInformer').get(),w=[];v.subscribe('messages-received',function(z,aa){w.forEach(function(ba){var ca=aa[ba._threadID];ca&&ba.receivedMessages(ca);});});u.addRetroactiveListener('state-changed',function(z){w.forEach(function(aa){var ba=z[aa._threadID];ba&&aa._handleStateChanged(ba);});});function x(z){var aa,ba;if(i.get('webmessenger_chat_tab_redesign')){aa=p[':fb:chat:conversation:message-group-messenger'].build();ba=p[':fb:mercury:typing-indicator-messenger'].build();}else{aa=p[':fb:chat:conversation:message-group'].build();ba=p[':fb:mercury:typing-indicator:typing'].build();aa.setNodeContent('profileName',z.name);}var ca=aa.getNode('profileLink');q.set(ca,z.name,'left');ca.href=z.href;aa.setNodeProperty('profilePhoto','src',z.image_src);var da=t._("{name} schreibt etwas ...",[t.param("name",z.short_name)]);q.set(ba.getRoot(),da,'above');j.appendContent(aa.getNode('messages'),ba.getRoot());return aa;}function y(z,aa,ba){this._animations={};this._activeUsers={};this._typingIndicator=aa;this._messagesView=ba;this._threadID=z;this._subscription=u.addRetroactiveListener('state-changed',function(ca){var da=ca[this._threadID];da&&this._handleStateChanged(da);}.bind(this));w.push(this);}Object.assign(y.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();w.remove(this);},receivedMessages:function(z){z.forEach(function(aa){if(!l.isViewer(aa.author))this._removeUserBubble(aa.author);}.bind(this));},_handleStateChanged:function(z){for(var aa in this._activeUsers)if(z.indexOf(aa)===-1){this._slideOutUserBubble(aa);delete this._activeUsers[aa];}if(z.length)m.getMulti(z,function(ba){var ca=this._messagesView.isScrolledToBottom(),da={};for(var ea in ba){var fa=this._activeUsers[ea];da[ea]=fa||x(ba[ea]).getRoot();if(!fa){j.appendContent(this._typingIndicator,da[ea]);if(i.get('chat_thread_typing_indicator_animated')){var ga=j.scry(this._typingIndicator,"._510u");for(var ha=0,ia=ga.length;ha<ia;ha++)n.render(n.createElement(h,{bootloadPlaceholder:n.createElement("span",null),bootloadLoader:k('MercuryTypingAnimation.react'),className:"_3e2s"}),ga[ha]);}}}var ja=Object.keys(da).length>0;ca&&this._messagesView.scrollToBottom(ja);this._activeUsers=da;}.bind(this));},_removeUserBubble:function(z,aa){var ba=this._getCurrentAnimation(z,aa);if(ba){ba.animation.stop();j.remove(ba.elem);delete this._animations[z];}if(z in this._activeUsers){j.remove(this._activeUsers[z]);delete this._activeUsers[z];}if(aa&&i.get('chat_thread_typing_indicator_animated')){var ca=j.scry(aa,"._510u");for(var da=0,ea=ca.length;da<ea;da++)n.unmountComponentAtNode(ca[da]);}aa&&j.remove(aa);},_slideOutUserBubble:function(z){var aa=this._activeUsers[z];if(this._getCurrentAnimation(z,aa)){return;}else if(aa){o.set(aa,'overflow','hidden');var ba=(new g(aa)).from('opacity',1).from('height',aa.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,z,aa)).go();this._animations[z]={animation:ba,elem:aa};}},_getCurrentAnimation:function(z,aa){if(this._animations[z]&&(!aa||this._animations[z].elem===aa))return this._animations[z];}});e.exports=y;},null);