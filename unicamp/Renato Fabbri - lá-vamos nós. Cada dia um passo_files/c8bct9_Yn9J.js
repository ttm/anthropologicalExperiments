/*!CK:2238484519!*//*1436299962,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["k98xa"]); }

__d("XComposerPhotoUploader",["AsyncUploadRequest","FileInputUploader","JSLogger","PhotosMimeType","PhotosUploadID","createArrayFromMixed","curry","emptyFunction","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();'use strict';function p(q){this.$XComposerPhotoUploader0=q.uploadData||{};this.$XComposerPhotoUploader1=q.uploadEndpoint;this.$XComposerPhotoUploader2=q.retryLimit;this.$XComposerPhotoUploader3=q.concurrentLimit;this.$XComposerPhotoUploader4=q.resizer;this.$XComposerPhotoUploader5=q.onUploadEnqueued||n;this.$XComposerPhotoUploader6=q.onUploadsEnqueued||n;this.$XComposerPhotoUploader7=q.onResizeStart||n;this.$XComposerPhotoUploader8=q.onResizeProgress||n;this.$XComposerPhotoUploader9=q.onResizeSuccess||n;this.$XComposerPhotoUploadera=q.onResizeFailure||n;this.$XComposerPhotoUploaderb=q.onUploadSent||n;this.$XComposerPhotoUploaderc=q.onUploadStart||n;this.$XComposerPhotoUploaderd=q.onUploadProgress||n;this.$XComposerPhotoUploadere=q.onUploadSuccess||n;this.$XComposerPhotoUploaderf=q.onUploadFailure||n;this.$XComposerPhotoUploaderg=i.create('composer');}p.prototype.upload=function(q){var r=Object.assign({},this.$XComposerPhotoUploader0),s=null;if(!this.$XComposerPhotoUploaderh(q)){var t=k.getNewID();q.uploadID=t;r.upload_id=t;this.$XComposerPhotoUploader5({uploadID:t,fileName:q.value.split('/').pop().split('\\').pop()});}else{s=l(q.files);s.forEach(function(w){if(!w.uploadID)w.uploadID=k.getNewID();this.$XComposerPhotoUploader5({uploadID:w.uploadID,fileName:w.name});}.bind(this));}this.$XComposerPhotoUploader6();var u=new h(q).setURI(this.$XComposerPhotoUploader1).setData(r).setAllowCrossOrigin(true).setNetworkErrorRetryLimit(this.$XComposerPhotoUploader2).setUploadInParallel(true);if(s&&s.length>0){u.setFiles({farr:s});if(this.$XComposerPhotoUploader4)u.setPreprocessHandler(this.$XComposerPhotoUploaderi.bind(this));if(this.$XComposerPhotoUploader3)u.setConcurrentLimit(this.$XComposerPhotoUploader3);}u.subscribe('progress',function(w,x){return this.$XComposerPhotoUploaderd(this.$XComposerPhotoUploaderk(x,q),x);}.bind(this));u.subscribe('failure',function(w,x){return this.$XComposerPhotoUploaderf(this.$XComposerPhotoUploaderk(x,q),x,s);}.bind(this));u.subscribe('start',function(w,x){return this.$XComposerPhotoUploaderc(this.$XComposerPhotoUploaderk(x,q),x);}.bind(this));u.subscribe('success',function(w,x){return this.$XComposerPhotoUploadere(this.$XComposerPhotoUploaderk(x,q),x);}.bind(this));try{u.send();this.$XComposerPhotoUploaderb(q);}catch(v){this.$XComposerPhotoUploaderg.error('error_send_unpublished_files',v);throw v;}};p.prototype.getAsyncUploadRequest=function(q,r){var s=new g().setData(Object.assign({},r&&r.data,this.$XComposerPhotoUploader0)).setFiles({farr:q}).setAllowCrossOrigin(true).setURI(this.$XComposerPhotoUploader1);if(this.$XComposerPhotoUploader3)s.setLimit(this.$XComposerPhotoUploader3);if(this.$XComposerPhotoUploader4)s.setPreprocessHandler(this.$XComposerPhotoUploaderi.bind(this));s.subscribe('start',function(t,u){return this.$XComposerPhotoUploaderc(u.getFile().uploadID,{upload:u});}.bind(this));s.subscribe('progress',function(t,u){return this.$XComposerPhotoUploaderd(u.getFile().uploadID,{upload:u,event:u.getProgressEvent()});}.bind(this));s.subscribe('success',function(t,u){return this.$XComposerPhotoUploadere(u.getFile().uploadID,{upload:u,response:u.getResponse()});}.bind(this));s.subscribe('failure',function(t,u){return this.$XComposerPhotoUploaderf(u.getFile().uploadID,{upload:u,response:u.getResponse()},q);}.bind(this));return s;};p.prototype.$XComposerPhotoUploaderk=function(q,r){if(q.upload){return q.upload.getFile().uploadID;}else return r.uploadID;};p.prototype.$XComposerPhotoUploaderi=function(q,r){var s=q.getFile();if(!s||!j(s.type).isJpeg())return r(q);var t=o();this.$XComposerPhotoUploader7(s);this.$XComposerPhotoUploader4.resizeBlob(s,function(u,v,w){v=v||s;if(u){var x=o()-t;this.$XComposerPhotoUploadera(s,v,u,x);return r(q);}v.uploadID=s.uploadID;v.filename=s.name;q.setFile(v);this.$XComposerPhotoUploader9(s,v,w,o()-t);r(q);}.bind(this),m(this.$XComposerPhotoUploader8,s.uploadID));};p.prototype.$XComposerPhotoUploaderh=function(q){return !!q.files&&g.isSupported();};e.exports=p;},null);
__d("updatePhotoProgressBar",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();'use strict';function g(h,event){if(event.loaded!=event.total){h.setPosition(50*event.loaded/event.total);}else{h.setPosition(50);h.setTarget(100,2000);}}e.exports=g;},null);
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;},null);
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;},null);
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i;function j(){this.name='FbtraceForcedByServerPolicy';}j.get=function(){if(typeof(i)=='undefined')i=new j();return i;};function k(){return g.forced;}Object.assign(j.prototype,h.prototype,{decideIfSampled:k});e.exports=j;},null);
/**
 * @generated SignedSource<<623c7cbcff19956af736c3d064fc689d>>
 *
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 *
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;},null);
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;},null);
__d("guardFunction",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;},null);
__d("Fbtrace",["Arbiter","BanzaiScribe","ErrorUtils","FbtraceForcedByServer","FbtraceForcedByServerPolicy","Random","SiteData","guardFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',p='AAAAAAAAAAA';for(var q in Error)if(Error.hasOwnProperty(q))s[q]=Error[q];var r=Error===null?null:Error.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=Error;function s(ha){Error.call(this,ha);}function t(ha){i.reportError(new s(ha));}function u(){var ha=function(){var ka=0,la=0,ma='';for(var na=10;na>=0;na--){if(ka<6){la=l.uint32();ka=32;}if(na===0)la=la&7;ma=o.charAt(la&63)+ma;la>>=6;ka-=6;}return ma;},ia,ja;for(ia=3;ia>0;ia--){ja=ha();if(ja!=p)return ja;}t('failed to generate valid Fbtrace id');return p;}function v(){Object.assign(this,v);}Object.assign(v,{isOn:function(){return false;},replySend:function(ha,ia){},requestSend:function(ha,ia,ja){ba(ha,ia);return {metadata:function(){return (void 0);},replyReceive:function(ka){}};}});var w=new v();function x(ha,ia,ja){if(!ha)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ia)throw {name:'ArgumentError',message:'no valid version specified'};var ka=h,la=0,ma=u(),na=u(),oa=aa(ma),pa={service:ha,version:ia},qa=function(va){if(typeof(va)=='undefined')return 'undefined';if(typeof(va)!='string')va=qa(JSON.stringify(va));return va;},ra=function(va){var wa='';for(var xa in va){if(wa.length>0)wa+='\x02';wa+=qa(xa)+'\x03'+qa(va[xa]);}return wa;},sa=function(va,wa,event,xa,ya){la++;return [ya,la,ma,va,wa,qa(event),ra(xa)].join('\x01');},ta=function(va,wa,event,xa,ya){if(!ya&&typeof(ya)=='undefined')ya=Date.now()*1000;var za=sa(va,wa,event,xa,ya);ka.log('fbtrace',za,oa);},ua=function(){return na;};ta(p,na,'#rqrecv',Object.assign(ja||{},pa));Object.assign(this,x,{replySend:function(va,wa){wa=Object.assign({},wa,pa,{success:va?'true':'false'});ta(p,na,'#rpsend',wa);},requestSend:function(va,wa,xa){ba(va,wa);var ya=ua(),za=u();xa=Object.assign({},xa,pa,{op:va,'remote:service':wa});ta(ya,za,'#rqsend',xa);return {metadata:function(){return ma+za;},replyReceive:function(ab){ta(ya,za,'#rprecv',Object.assign(ab||{},pa));},parentNode:this};}});}Object.assign(x,{isOn:function(){return true;}});function y(){return w;}function z(ha,ia,ja){ja=ja||{};ja.init=true;var ka=k.get();if(ka.isSampled()){return new x(ha,ia,ja);}else return new v();}function aa(ha){var ia=ha.charAt(ha.length-1);return o.indexOf(ia)%32;}function ba(ha,ia){if(!ha)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ia)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function ca(ha,ia){var ja=w,ka;w=ha;try{ka=ia();}finally{w=ja;}return ka;}var da=function(ha,ia){var ja=y(),ka=ia.request,la=false;if(!ja.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(ka.uri.toString())){ja=z('photo_upload_kludge',String(m.revision||'dev'),{policy:'PhotoUpload'});la=true;}if(ja.isOn()){var ma=la?{policy:'PhotoUpload'}:{};if(ka.userActionId)ma.user_action_id=ka.userActionId;var na=ja.requestSend(ka.uri.toString(),'www',ma);ka.fbtraceRemoteNode=na;ka.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},ea=function(ha,ia){ia.request.fbtraceRemoteNode.replyReceive({is_last:ia.response.is_last,success:true});setTimeout(function(){ia.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},fa=function(ha,ia){ia.request.fbtraceRemoteNode.replyReceive({is_last:ia.response.is_last,success:false,error_code:ia.response.error,error_summary:ia.response.errorSummary,error_description:ia.response.errorDescription});setTimeout(function(){ia.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ga=function(ha,ia){return ia.request.fbtraceRemoteNode;};g.subscribe('AsyncRequest/will_send',da);g.subscribe('AsyncRequest/response',n(ga,ea));g.subscribe('AsyncRequest/error',n(ga,fa));e.exports={defaultNode:y,requestReceive:z,withDefaultNode:ca};},null);
__d("PhotosMultiUploadInput",["Arbiter","Animation","AsyncUploadRequest","ComposerWaterfallEvent","ComposerXController","ComposerXDragDropUtils","ComposerXMarauderLogger","ComposerXMediaUploadHandler","CSS","Dialog","DOM","DragDropTarget","Event","JpegResizer","Parent","PhotosMimeType","PhotosUploadID","PhotosUploadWaterfallXMixin","PUWApplications","PUWMethods","PUWSteps","ProgressBar","Tooltip","WaterfallIDGenerator","XComposerPhotoUploader","$","csx","cx","mixin","performanceNow","fbt","updatePhotoProgressBar","Fbtrace"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){b.__markCompiled&&b.__markCompiled();var ma=1366052;b("Fbtrace");function na(wa,xa,ya,za){"use strict";this._grid=ta.getInstance(za.gridID);this._grid.setProgressBarMarkup(wa).setVideoIconMarkup(xa).setConfig(za);ya.getInput().multiple=(za.maxselect!=1)&&i.isSupported();ya.subscribe('change',function(ab,event){if(event.getTarget().value)this._grid.doFileUpload(ya);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(aa.CLIENT_FLOW_BEGIN,{custom_tags:{high_quality:za.initWithHighQuality}});}this._grid.logStep(aa.CLIENT_SELECT_BEGIN);g.inform('PhotosMultiUploadInput/loaded/'+za.gridID,null,g.BEHAVIOR_PERSISTENT);}na.prototype.getGrid=function(){"use strict";return this._grid;};na.prototype.onQualitySettingChanged=function(wa){"use strict";this._grid.setQuality(wa);};Object.assign(na,{imageUploadDone:function(wa,xa,ya,za,ab){oa[wa].imageUploadDone(xa,ya,za,ab);},addCameraImage:function(wa,xa,ya){oa[wa].addCameraImage(xa,ya);},initDragDrop:function(wa,xa){g.inform('PhotosMultiUploadInput/initDragDrop/'+wa,{dragDropArea:xa},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(wa,xa){oa[wa].removeLoadingIndicator(xa.getFile().uploadID);},doFileUpload:function(wa,xa){oa[wa].doFileUpload(xa);},onFilesDrop:function(wa,xa){oa[wa].onFilesDrop(xa);},getWaterfallID:function(wa){return ta.getInstance(wa).getWaterfallID();},clearSession:function(wa){oa[wa].clearSession();},getConfig:function(wa){return oa[wa].getConfig();}});var oa={},pa=0,qa=ia(x);for(var ra in qa)if(qa.hasOwnProperty(ra))ta[ra]=qa[ra];var sa=qa===null?null:qa.prototype;ta.prototype=Object.create(sa);ta.prototype.constructor=ta;ta.__superConstructor__=qa;function ta(wa){"use strict";this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=wa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;this._uploadIDToFileUpload={};this._failedUploadIDs={};g.subscribe('multi-upload/video-removed/'+this._gridID,function(){q.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(xa){xa.clear();});}.bind(this));g.subscribe('multi-upload/image-removed/'+this._gridID,function(){this._logComposerWaterfallEvent(j.PHOTO_REMOVE);}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+this._gridID,function(xa,ya){this.initDragDrop(ya.dragDropArea);}.bind(this));g.subscribe('AttachmentsPhotoEditor/logPhotoEditorLaunched'+this._gridID,function(xa,ya){this.logStep(aa.CLIENT_PHOTO_EDIT_BEGIN);}.bind(this));g.subscribe('AttachmentsPhotoEditor/newImage'+this._gridID,this._onEditedImage.bind(this));}ta.prototype.getWaterfallID=function(){"use strict";if(!this._waterfallID)this._waterfallID=da.generate();return this._waterfallID;};ta.prototype.getWaterfallAppName=function(){"use strict";return y.WEB_COMPOSER;};ta.prototype.getLoadingIndicator=function(wa){"use strict";var xa=this._loadingIndicators[wa];return xa;};ta.prototype.initDragDrop=function(wa){"use strict";this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new r(wa).setOnFilesDropCallback(function(xa){this.onFilesDrop(xa,z.DRAGDROP);}.bind(this)).setFileFilter(l.filterImages).enable();};ta.prototype.setConfig=function(wa){"use strict";this._config=wa;this._isHighQuality=(wa.hasOwnProperty('initWithHighQuality'))?wa.initWithHighQuality:true;if(!t.isSupported()){this.logStep(aa.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer){this._resizer=new t(this._config.maxselect===1?1:t.DEFAULT_POOL_SIZE);this._resizer.setHighQuality(this._isHighQuality);}if(!this._waterfallID)this._waterfallID=wa.waterfallID;this._concurrentLimit=wa.concurrentLimit;return this;};ta.prototype.setProgressBarMarkup=function(wa){"use strict";this._progressBarMarkup=wa;return this;};ta.prototype.setVideoIconMarkup=function(wa){"use strict";this._videoIconMarkup=wa;var xa=q.find(wa,"._3ev");s.listen(xa,'click',this._onVideoRemoved.bind(this));return this;};ta.prototype.setQuality=function(wa){"use strict";this._isHighQuality=wa;this._resizer&&this._resizer.setHighQuality(wa);this.logStep(aa.CLIENT_QUALITY_SWITCH,{custom_tags:{high_quality:this._isHighQuality}});};ta.prototype.imageUploadDone=function(wa,xa,ya,za){"use strict";this._numUploadsSucceeded++;var ab=this.getLoadingIndicator(xa);if(!ab)return;if(q.contains(document.body,ab.getRoot()))q.replace(ab.getRoot(),wa);var bb={};bb[xa]=ya;this._informImagesAdded(bb,za);this._markUploadAsFinished();this._loadingIndicators[xa]=null;};ta.prototype.addCameraImage=function(wa,xa){"use strict";this.insertIntoGrid(wa);this._informImagesAdded({'0':xa},{});this.logStep(aa.CLIENT_ATTACH_PHOTO,{method:z.CAMERA,fbid:xa});};ta.prototype._informImagesAdded=function(wa,xa){"use strict";g.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:wa,tagInfo:{exifLocation:xa}});g.inform('composer/updateViewerLocationEstimate',xa);};ta.prototype._generateLoadingIndicatorForPhoto=function(wa){"use strict";this._generateLoadingIndicator(wa.uploadID);};ta.prototype._generateLoadingIndicator=function(wa){"use strict";this._numRemainingFiles++;var xa=this._progressBarMarkup.cloneNode(true);s.listen(xa,'click',this._clickHandler.bind(this,wa));this.insertIntoGrid(xa);this._loadingIndicators[wa]=new ba(xa);};ta.prototype._generateUploadIDsAndLoadingIndicators=function(wa){"use strict";for(var xa=0;xa<wa.length;xa++){if(!wa[xa].uploadID)wa[xa].uploadID=w.getNewID();this._generateLoadingIndicator(wa[xa].uploadID);}};ta.prototype._clickHandler=function(wa,xa){"use strict";var ya=xa.target,za="_639";if(u.byClass(ya,za))if(this._failedUploadIDs[wa]){this.removeLoadingIndicator(wa);}else this.fileUploadCanceled(wa,this._uploadIDToFileUpload[wa]);var ab="_2zo7";if(u.byClass(ya,ab)){o.hide(q.find(this.getLoadingIndicator(wa).getRoot(),"._2zo5"));this._retryFileUpload(this._uploadIDToFileUpload[wa].getFile());this._failedUploadIDs[wa]=false;}var bb="_2zo8";if(u.byClass(ya,bb))this.removeLoadingIndicator(wa);};ta.prototype.fileUploadFailure=function(wa,xa,ya){"use strict";this._numUploadsFailed++;this._failedUploadIDs[wa]=true;var za=Date.now()-this._uploadTimers[wa],ab=0;if(xa.upload)ab=xa.upload.getRetryCount?xa.upload.getRetryCount():0;var bb=xa.response.getErrorDescription(),cb=xa.response.getError();if(cb===ma)bb=JSON.stringify(ya);this.logStep(aa.CLIENT_TRANSFER_FAIL,{dt:za,error_code:cb,error_info:bb,bytes:xa.upload.getFile().size,auto_retry_count:ab,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){var db=xa.response.isTransient()||xa.response.getError()==1004||xa.response.getError()==1006,eb=db&&this._uploadIDToFileUpload[wa];this._showNewUploadFailedMessage(wa,xa.upload.getFile().name||xa.upload.getFile().filename||'',xa.response.getErrorSummary(),xa.response.getErrorDescription(),eb,xa.upload.getFile());this._markUploadAsFinished();}else{this._showUploadFailedMessage(wa);this._fadeOutFileUpload(wa);}};ta.prototype._fadeOutFileUpload=function(wa){"use strict";new h(this.getLoadingIndicator(wa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,wa)).go();};ta.prototype._showUploadFailedMessage=function(wa){"use strict";o.hide(q.find(this.getLoadingIndicator(wa).getRoot(),"._5l83"));o.show(q.find(this.getLoadingIndicator(wa).getRoot(),"._5l82"));};ta.prototype._showNewUploadFailedMessage=function(wa,xa,ya,za,ab,bb){"use strict";var cb=this.getLoadingIndicator(wa).getRoot();o.hide(q.find(cb,"._5l83"));o.show(q.find(cb,"._2zo5"));var db=q.find(cb,"._2zo6");q.setContent(db,xa);var eb=q.find(cb,"._2zo5");ca.set(eb,ya+': '+za);if(ab){var fb=q.find(cb,"._2zo7");o.show(fb);}else{var gb=q.find(cb,"._2zo8");o.show(gb);}};ta.prototype._finishUploadBatch=function(){"use strict";g.inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(aa.CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(aa.CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};ta.prototype.fileUploadCanceled=function(wa,xa){"use strict";xa&&xa.abort();var ya={latency:Date.now()-this._uploadTimers[wa]};if(xa&&xa.getFile())ya.bytes=xa.getFile().size;this.logStep(aa.CLIENT_TRANSFER_CANCEL,ya);this.removeFileUpload(wa);};ta.prototype.removeFileUpload=function(wa){"use strict";this.removeLoadingIndicator(wa);this._markUploadAsFinished();};ta.prototype._markUploadAsFinished=function(){"use strict";this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);if(this._numRemainingFiles===0)this._finishUploadBatch();};ta.prototype.doFileUpload=function(wa){"use strict";var xa=false,ya=false;switch(this._config.supportedFileTypes){case 'photos':ya=true;break;case 'videos':xa=true;break;case 'both':xa=ya=true;break;}var za=xa&&n.isVideoFile(wa);this._submitListener&&this._submitListener.remove();if(za){var ab=u.byTag(fa(this._gridID),'form'),bb=k.getComposerID(ab),cb=new n(bb);cb.handleVideoSelected(wa);}else if(ya){this._photosSelected(wa);}else new p().setBody(ka._("Leider kannst du nur Videodateien ausw\u00e4hlen.")).setTitle(ka._("Datei nicht unterst\u00fctzt")).setModal(true).setButtons(p.OK).show();};ta.prototype.getConfig=function(){"use strict";return this._config;};ta.prototype._resizeUpload=function(wa,xa){"use strict";var ya=wa.getFile();if(!ya||!v(ya.type).isJpeg())return xa(wa);var za=ja();this.logStep(aa.CLIENT_PROCESS_BEGIN,{bytes:ya.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(ya,function(ab,bb,cb){bb=bb||ya;if(ab){this.logStep(aa.CLIENT_PROCESS_FAIL,{dt:ja()-za,bytes:bb.size,error_code:ab.code,error_info:ab.message,custom_tags:{high_quality:this._isHighQuality}});return xa(wa);}bb.uploadID=ya.uploadID;bb.filename=ya.name;wa.setFile(bb);this.logStep(aa.CLIENT_PROCESS_SUCCESS,{dt:ja()-za,media_data_size:ya.size,bytes:bb.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:cb}});xa(wa);}.bind(this),this._onResizeProgress.bind(this,ya.uploadID));};ta.prototype._onResizeStart=function(wa){"use strict";this.logStep(aa.CLIENT_PROCESS_BEGIN,{bytes:wa.size,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeFail=function(wa,xa,ya,za){"use strict";this.logStep(aa.CLIENT_PROCESS_FAIL,{dt:za,bytes:xa.size,error_code:ya.code,error_info:ya.message,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeSuccess=function(wa,xa,ya,za){"use strict";this.logStep(aa.CLIENT_PROCESS_SUCCESS,{dt:za,media_data_size:wa.size,bytes:xa.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:ya}});};ta.prototype._isExceedMaxSelect=function(wa){"use strict";return this._config.maxselect>1&&wa>this._config.maxselect;};ta.prototype._showTooManyPhotosDialog=function(){"use strict";new p().setTitle(ka._("Zu viele Fotos")).setBody(ka._({"*":"Leider kannst du nur {maxselect} Fotos in einer Nachricht schicken. Wenn du m\u00f6chtest, kannst du Fotos zu einer weiteren Nachricht hinzuf\u00fcgen."},[ka.param("maxselect",this._config.maxselect,[0])])).setButtons(p.OK).setModal(true).show();};ta.prototype._photosSelected=function(wa){"use strict";var xa=wa.getInput(),ya=ua(xa);if(this._isExceedMaxSelect(ya)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this._upload(wa,ya);};ta.prototype._upload=function(wa,xa){"use strict";var ya=wa.getInput(),za=this._config.uploadData;if(this._config.waterfallID)za.qn=this._config.waterfallID;var ab=function(){g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:xa});}.bind(this),bb=new ea({uploadEndpoint:this._config.photoEndpoint,uploadData:za,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:ab,onUploadSent:function(){return wa.clear();},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});bb.upload(ya);this.logStep(aa.CLIENT_SELECT_SUCCESS,{times_selected:pa++,volume:xa,method:'file_selector'});};ta.prototype._onVideoRemoved=function(){"use strict";this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);};ta.prototype.removeLoadingIndicator=function(wa){"use strict";var xa=this.getLoadingIndicator(wa);xa&&q.remove(xa.getRoot());delete this._loadingIndicators[wa];};ta.prototype._onFileUploadStart=function(wa,xa){"use strict";this._uploadIDToFileUpload[wa]=xa.upload;var ya=q.find(this.getLoadingIndicator(wa).getRoot(),"._639");o.show(ya);this._uploadTimers[wa]=Date.now();var za={custom_tags:{high_quality:this._isHighQuality}};if(xa.upload&&xa.upload.getFile())za.size=xa.upload.getFile().size;this.logStep(aa.CLIENT_TRANSFER_BEGIN,za);this._logComposerWaterfallEvent(j.PHOTO_ADD);};ta.prototype._onUploadProgress=function(wa,xa){"use strict";var ya=this.getLoadingIndicator(wa);if(!ya||this._failedUploadIDs[wa])return;this._showProgressBar(ya);o.removeClass(ya.getRoot(),"_5v_0");la(ya,xa.event);};ta.prototype._onResizeProgress=function(wa,event){"use strict";var xa=this.getLoadingIndicator(wa);if(!xa)return;this._showProgressBar(xa);o.addClass(xa.getRoot(),"_5v_0");xa.setPosition(100*event.written/event.total);};ta.prototype._showProgressBar=function(wa){"use strict";o.hide(q.find(wa.getRoot(),"._2om"));o.show(q.find(wa.getRoot(),"._5e4h"));};ta.prototype._onFileUploadSuccess=function(wa,xa){"use strict";var ya=Date.now()-this._uploadTimers[wa],za={dt:ya};if(xa.upload){za.bytes=xa.upload.getFile().size;za.auto_retry_count=xa.upload.getRetryCount?xa.upload.getRetryCount():0;za.custom_tags={high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried};}this.logStep(aa.CLIENT_TRANSFER_SUCCESS,za);this._logComposerWaterfallEvent(j.PHOTO_ADD_SUCCESS);};ta.prototype._logComposerWaterfallEvent=function(event){"use strict";if(!u.byClass(fa(this._gridID),"_119"))return;m.logEvent(event,this._getComposerID());};ta.prototype._getComposerID=function(){"use strict";return k.getComposerID(this._gridID);};ta.prototype._getAsyncUploadRequest=function(wa){"use strict";var xa=new ea({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return xa.getAsyncUploadRequest(wa);};ta.prototype._onEditedImage=function(wa,xa){"use strict";this._onBeforeAddUploadedImages();this.logStep(aa.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([xa.blob]);var ya=this._getGridItemElementByFBID(xa.fbid);if(ya){var za=this._loadingIndicators[xa.blob.uploadID].getRoot();q.insertBefore(ya,za);}g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:z.EDITOR});var ab=this._getAsyncUploadRequest([xa.blob]);ab.setData(Object.assign({},this._config.uploadData,{original_fbid:xa.fbid,stickers:xa.stickers,text_overlays:xa.textOverlays,has_crop:xa.hasCrop,has_filter:xa.hasFilter}));ab.send();this.logStep(aa.CLIENT_SELECT_SUCCESS,{volume:1,method:z.EDITOR});this.logStep(aa.CLIENT_PHOTO_EDIT_SUCCESS);};ta.prototype._getGridItemElementByFBID=function(wa){"use strict";var xa=q.scry(fa(this._gridID),".fbVaultGridItem");for(var ya=0;ya<xa.length;ya++)if(xa[ya].dataset.originalfbid==wa)return xa[ya];return null;};ta.prototype.onFilesDrop=function(wa,xa){"use strict";if(this._isExceedMaxSelect(wa.length)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this.logStep(aa.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(wa);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:wa.length,method:xa||z.DRAGDROP});var ya=this._getAsyncUploadRequest(wa);if(this._resizer)ya.setPreprocessHandler(this._resizeUpload.bind(this));ya.send();this.logStep(aa.CLIENT_SELECT_SUCCESS,{volume:wa.length,method:xa||z.DRAGDROP});};ta.prototype._retryFileUpload=function(wa){"use strict";this._numRemainingFiles++;g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1});this.logStep(aa.CLIENT_TRANSFER_MANUAL_RETRY);wa.manuallyRetried=true;var xa=this._getAsyncUploadRequest([wa]);xa.send();};ta.prototype._onBeforeAddUploadedImages=function(){"use strict";if(!this.sessionStarted)this.logStep(aa.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ta.prototype.clearSession=function(){"use strict";this.sessionStarted=false;};ta.prototype.insertIntoGrid=function(wa){"use strict";var xa=q.scry(fa(this._gridID),"._577")[0];if(xa){q.insertBefore(xa,wa);}else q.prependContent(fa(this._gridID),wa);};ta.prototype._getUploadID=function(wa,xa){"use strict";if(wa.upload){return wa.upload.getFile().uploadID;}else return xa.uploadID;};ta.getInstance=function(wa){"use strict";oa[wa]=oa[wa]||new ta(wa);return oa[wa];};function ua(wa){if(!va(wa))return 1;return wa.files.length;}function va(wa){return !!wa.files&&i.isSupported();}e.exports=na;},null);
__d("TimelineMapScrollableArea",["Animation","ArbiterMixin","CSS","DOM","Event","Run","Scroll","SimpleDrag","Style","Vector","$","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u){t&&this.init(q(t),u);}Object.assign(s.prototype,h,{init:function(t,u){u=u||{};this._elem=t;this._wrap=j.find(t,'div.fbScrollableAreaWrap');this._body=j.find(this._wrap,'div.fbScrollableAreaBody');this._track=j.find(t,'div.fbScrollableAreaTrack');this._gripper=j.find(this._track,'div.fbScrollableAreaGripper');this._options=u;this.adjustGripper();this._listeners=[k.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(u.fade!==false)this._listeners.push(k.listen(t,'mouseenter',r(this.adjustGripper,this)),k.listen(t,'mouseenter',r(this.showScrollbar,this)),k.listen(t,'mousemove',this._handleMousemove.bind(this)),k.listen(t,'mouseout',r(this.hideScrollbar,this)));if(u.fade!==(void 0))this._listeners.push(k.listen(this._track,'click',this.clickToScroll.bind(this)));if(u.verticalscroll)this._listeners.push(k.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),k.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!u.persistent)l.onLeave(this.destroy.bind(this));},getRoot:function(){return this._elem;},initDrag:function(){var t=new n(this._gripper);t.subscribe('start',function(u,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var v=p.getEventPosition(event).x,w=this._gripper.offsetLeft,x=t.subscribe('update',function(z,aa){var ba=p.getEventPosition(aa).x-v,ca=this._elem.clientWidth,da=this._body.offsetWidth,ea=this._track.offsetWidth,fa=ca/da*ea,ga=da-this._wrap.offsetWidth,ha=w+ba,ia=ea-fa;ha=Math.max(Math.min(ha,ia),0);var ja=ha/ia*ga;m.setLeft(this._wrap,ja);}.bind(this)),y=t.subscribe('end',function(){t.unsubscribe(x);t.unsubscribe(y);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var t=this._elem.clientWidth,u=this._body.offsetWidth,v=this._track.offsetWidth,w=t/u*v;if(w<v){o.set(this._gripper,'width',w+'px');var x=m.getLeft(this._wrap)/u*v;o.set(this._gripper,'left',x+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var t=m.getLeft(this._wrap),u=this._wrap.scrollWidth-this._wrap.clientWidth;i.conditionClass(this._elem,'contentBefore',t>0);i.conditionClass(this._elem,'contentAfter',t<u);},destroy:function(){this._listeners.forEach(function(t){t.remove();});this._listeners.length=0;},_handleMousemove:function(event){var t=p.getElementPosition(this._track).y,u=p.getElementDimensions(this._track).y;if(Math.abs(t+u/2-p.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=setTimeout(function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new g(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.bind(null,this._track,'invisible_elem')).go();}.bind(this),750);return this;},showScrollbar:function(t){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();o.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(t!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var t=p.getEventPosition(event).x,u=this._elem.clientWidth,v=this._body.offsetWidth,w=this._track.offsetWidth,x=u/v*w,y=p.getElementPosition(this._gripper);if(t>=y.x&&t<=y.x+x)return;var z=t<y.x?-1:1,aa=this._wrap.offsetWidth*.8*z;this.scrollBy(aa);},scrollBy:function(t){this.setScroll(m.getLeft(this._wrap)+t);},getMaxBodyOffset:function(){return this._body.offsetWidth-this._wrap.offsetWidth;},setScroll:function(t){var u=t;u=Math.max(Math.min(u,this.getMaxBodyOffset()),0);m.setLeft(this._wrap,u);},scrollIntoView:function(t){var u=this._wrap.clientWidth,v=t.offsetWidth,w=m.getLeft(this._wrap),x=w+u,y=t.offsetLeft,z=y+v;if(y<w||u<v){this.setScroll(y);}else if(z>x)this.setScroll(w+(z-x));},mouseWheel:function(event){if(this.getMaxBodyOffset()<=0)return;var t=0;if(event.wheelDelta){var u=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)u=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;t=-u*10/40;}else if(event.detail)t=event.detail*10;this.scrollBy(t);event.prevent();}});e.exports=a.TimelineMapScrollableArea||s;},null);
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","Arbiter","MercuryLastMessageIndicator.react","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryConfig","MercuryThreadlistConstants","MercuryViewer","MercuryMessageGroup","WebMessengerMessagesSelection","MessagingTag","MessengerContextBannerBootloader","React","ReactComponentRenderer","MercuryShareAttachmentRenderLocations","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","cx","debounce","formatDate","ge","fbt","MercuryMessages","MercuryThreadInformer","MercuryThreadActions","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){b.__markCompiled&&b.__markCompiled();var oa=b('MercuryMessages').get(),pa=b('MercuryThreadInformer').get(),qa=b('MercuryThreadActions').get(),ra=b('MercuryThreads').get();function sa(lb,mb,nb,ob,pb,qb,rb,sb){"use strict";this._manager=lb;this._rootElement=mb;this._loadingSpinner=nb;this._noSelectedConversation=ob;this._newMessageLink=pb;this._showUnreadLink=qb;this.contextBanner=rb;k.empty(this._rootElement);this._pagerExponent=-1;var tb=ca[':fb:web-messenger:read-view:recent-messages'].build();k.setContent(this._rootElement,tb.getRoot());this._selectedConversationView=tb.getRoot();this._messageList=tb.getNode('messagelist');this._loadMoreButton=tb.getNode('loadMoreButton');this._loadMoreLink=tb.getNode('loadMoreLink');this._loadMoreCount=tb.getNode('loadMoreCount');this._loadingMoreCount=tb.getNode('loadingMoreCount');this._indicatorNode=tb.getNode('lastMessageIndicator');this._unseenMessagesNotice=new j(this._manager);this._unseenMessagesNotice.setNoticeContextNode(sb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};da.setupSelectionListener(this._messageList);this._manager.addScrollCallback(ka(kb.bind(null,this),500));ia.addSubscriptions(g.listen(this._loadMoreLink,'click',cb.bind(null,this)),pa.subscribe('messages-reordered',function(ub,vb){var wb=this._threadID&&vb[this._threadID];if(wb)ya(this);}.bind(this)),pa.subscribe('messages-updated',function(ub,vb){var wb=this._threadID&&vb[this._threadID];if(wb)var xb=Object.keys(wb),yb=xb.length&&wb[xb[0]];if(wb&&yb)ya(this,vb[this._threadID]);}.bind(this)),pa.subscribe('messages-updated',kb.bind(null,this)),pa.subscribe('messages-received',function(ub,vb){if(this._threadID&&vb[this._threadID])bb(this,vb);}.bind(this)),pa.subscribe('thread-read-changed',function(ub,vb){if(vb[this._threadID])hb(this,vb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&cb(this);}.bind(this)));}sa.prototype.hideView=function(){"use strict";this._active=false;i.hide(this._rootElement);i.hide(this._loadingSpinner);i.hide(this._noSelectedConversation);i.hide(this.contextBanner);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};sa.prototype.updateView=function(){"use strict";this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);i.show(this._rootElement);if(this.contextBanner)i.show(this.contextBanner);var lb=ua(this);va(this);t.clear();if(lb){wa(this);}else fb(this);};sa.prototype.destroy=function(){"use strict";ta(this);this._unseenMessagesNotice.destroy();w.unmountComponentAtNode(this._indicatorNode);if(this.contextBannerElem!=null)w.unmountComponentAtNode(this.contextBannerElem);k.empty(this.contextBanner);};function ta(lb){lb._messagesSubscription&&oa.unsubscribe(lb._messagesSubscription.subscriber_id,lb._messagesSubscription.thread_id);lb._messagesSubscription=null;}function ua(lb){var mb=aa.getCurrentStateData();if(!lb._threadID||lb._threadID!=mb.thread_id)return true;return false;}function va(lb){var mb=aa.getCurrentStateData();lb._state=aa.getCurrentDetailState();lb._threadID=mb.thread_id;lb._selectionEnabled=!!mb.message_action;lb._bugReportingEnabled=mb.bug_reporting_enabled;da.updateSelection(lb._messageList);i.conditionClass(lb._messageList,'bugReportingEnabled',lb._bugReportingEnabled);}function wa(lb){k.scry(lb._rootElement,'.stickerContainer').forEach(function(mb){return w.unmountComponentAtNode(mb);});k.empty(lb._messageList);if(lb.contextBannerElem){w.unmountComponentAtNode(lb.contextBannerElem);k.empty(lb.contextBanner);}i.show(lb._loadingSpinner);i.hide(lb._loadMoreButton);ta(lb);lb._pagerExponent=-1;w.unmountComponentAtNode(lb._indicatorNode);if(lb._lastMessageIndicator){lb._lastMessageIndicator.unmount();delete lb._lastMessageIndicator;}if(lb._threadID){i.show(lb._selectedConversationView);i.hide(lb._noSelectedConversation);lb._manager._flexArea.showAtTop(false);if(!lb._olderMessageID[lb._threadID]){xa(lb);}else ya(lb);lb._manager.scrollToBottom(false);}else{jb(lb);i.hide(lb._selectedConversationView);i.show(lb._noSelectedConversation);i.hide(lb._loadingSpinner);lb._manager._flexArea.showAtTop(true);}}function xa(lb){lb._loadMessagesInFlight[lb._threadID]=true;lb._currentCountMap[lb._threadID]=fa.INITIAL_MESSAGES_LIMIT+1;i.hide(lb._loadMoreButton);var mb=oa.getThreadMessagesRange(lb._threadID,0,lb._currentCountMap[lb._threadID],za.bind(null,lb),null,o.WEBMESSENGER);if(mb){lb._messagesSubscription={subscriber_id:mb,thread_id:lb._threadID};}else ya(lb);}function ya(lb,mb){if(!lb._threadID||!lb._olderMessageID[lb._threadID])return;var nb=oa.getThreadMessagesSinceTimestamp(lb._threadID,ib(lb._olderMessageID[lb._threadID]));if(nb.length>lb._currentCountMap[lb._threadID])lb._currentCountMap[lb._threadID]=nb.length;ab(lb,nb,mb);}function za(lb,mb){lb._loadMessagesInFlight[lb._threadID]=false;if(mb&&mb.length){var nb=mb[0].timestamp,ob=lb._olderMessageID[lb._threadID]?ib(lb._olderMessageID[lb._threadID]):null;if(!ob||nb<ob)lb._olderMessageID[lb._threadID]=mb[0].message_id;}}function ab(lb,mb,nb){i.hide(lb._loadingSpinner);i.conditionShow(lb._loadMoreButton,!oa.hasLoadedAllMessages(lb._threadID));var ob=ra.getThreadMetaNow(lb._threadID);if(ob){var pb=ob.message_count-mb.length;pb=(pb<0)?0:pb;k.setContent(lb._loadMoreCount,pb);k.setContent(lb._loadingMoreCount,pb);}if(ob&&ob.is_canonical&&p.ShowContextBanner&&oa.hasLoadedAllMessages(lb._threadID)&&lb.contextBanner)v.bootload(lb._threadID,y.WEB_INBOX,function(yb){lb.contextBannerElem=yb;ba.set(lb._rootElement,'padding-top','80px');k.prependContent(lb.contextBanner,lb.contextBannerElem);});var qb=function(yb){var zb,ac=ma('wm:'+yb);if(ac)zb=ha.findAll(ac);return zb||[];},rb=[],sb=s.calculateMessageGroups(mb),tb={},ub=[];sb.forEach(function(yb){var zb=yb[0].message_id,ac=false;if(nb){ac=yb.some(function(cc){return cc.message_id in nb;});if(!ac){rb=qb(zb);ac=rb.some(function(cc){return cc in nb;});}}if(!ac){rb=qb(zb);if(yb.length==rb.length){for(var bc=0;bc<yb.length;bc++)if(yb[bc].message_id!=rb[bc]){ac=true;break;}}else ac=true;}if(ac)tb[zb]=1;ub.push('wm:'+zb);});var vb=function(yb){return !tb[sb[yb][0].message_id];},wb=function(yb){var zb=sb[yb],ac=da.renderMessageGroup(zb);if(yb==ub.length-1)lb._messageGroup=ac;return ac.getRoot();},xb=function(yb){return da.renderMessageSeparatorForIndex(sb,yb);};n.updateList(lb._messageList,ub,vb,wb,xb);lb._lastMessage=mb[mb.length-1];eb(lb);fb(lb);lb._manager.poke();}function bb(lb,mb){var nb=mb[lb._threadID],ob=lb._manager._flexArea.getScrollableArea(),pb=ob.getScrollHeight();nb.forEach(function(sb){sb.timestamp_relative=la(new Date(sb.timestamp),'g:ia');var tb=s.canAppendMessageToLastGroup(lb._lastMessage,sb);if(!tb){lb._messageGroup=da.renderMessageGroup([sb]);var ub=sb.timestamp,vb=lb._lastMessage?lb._lastMessage.timestamp:0,wb=fa.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!vb||ub-vb>=wb){var xb=da.renderMessageSeparator(sb);k.appendContent(lb._messageList,xb);}k.appendContent(lb._messageList,lb._messageGroup.getRoot());}else da.appendMessageToGroup(lb._messageGroup,sb);if(sb.author!=r.getID())i.addClass(lb._messageGroup.getRoot(),'unreadHighlight');lb._lastMessage=sb;});lb._manager._flexArea.poke();var qb=ob.getScrollHeight(),rb=ob.getScrollTop();lb._unseenMessagesNotice.updateOnMessagesReceived(pb,qb,rb,mb);eb(lb);if(lb._manager.isScrolledToBottom())fb(lb);}function cb(lb){i.addClass(lb._loadMoreButton,'async_saving');if(lb._loadMessagesInFlight[lb._threadID])return;lb._loadMessagesInFlight[lb._threadID]=true;lb._pagerExponent=Math.min(lb._pagerExponent+1,fa.EXPONENTIAL_PAGER_MAX_CYCLES);var mb=Math.pow(2,lb._pagerExponent),nb=lb._currentCountMap[lb._threadID]+(mb*q.WEBMESSENGER_MORE_MESSAGES_COUNT);ta(lb);var ob=oa.getThreadMessagesRange(lb._threadID,0,nb,function(pb){i.removeClass(lb._loadMoreButton,'async_saving');lb._currentCountMap[lb._threadID]=nb;za(lb,pb);lb._loadMessagesInFlight[lb._threadID]=false;},null,o.WEBMESSENGER);if(ob){lb._messagesSubscription={subscriber_id:ob,thread_id:lb._threadID};}else ya(lb);}function db(lb){if(!lb._lastMessageIndicator){var mb;lb._lastMessageIndicator=new x(m,lb._indicatorNode);lb._lastMessageIndicator.setProps({threadID:lb._threadID,className:"_510o",indicatorWillShow:function(){return mb=lb._manager.isScrolledToBottom();},indicatorDidShow:function(){return mb&&lb._manager.scrollToBottom(true);}});}return lb._lastMessageIndicator;}function eb(lb,mb){db(lb).setProps({lastMessage:lb._lastMessage});}function fb(lb){if(ea.isActive(5000)){gb(lb);}else ea.subscribeOnce(gb.bind(null,lb));}function gb(lb){if(!lb._threadID||!lb._active)return;qa.markRead(lb._threadID);var mb=k.scry(lb._messageList,'.unreadHighlight');mb.forEach(function(nb){i.removeClass(nb,'unreadHighlight');i.addClass(nb,'unreadFading');new h(nb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){i.removeClass(nb,'unreadFading');ba.set(nb,'background','');ba.set(nb,'borderColor','');}).go();});}function hb(lb,mb){if(!mb.mark_as_read)return;var nb=k.scry(lb._messageList,'.unreadHighlight');for(var ob=0;ob<nb.length;ob++){var pb=nb[ob],qb=ha.findAll(pb),rb=oa.getMessagesFromIDs(qb);if(rb[rb.length-1].timestamp<mb.timestamp)i.removeClass(pb,'unreadHighlight');}}function ib(lb){var mb=oa.getMessagesFromIDs([lb])[0];return mb?mb.timestamp:0;}function jb(lb){if(lb._builtNoSelectionBox)return;var mb=function(){var ob=aa.getCurrentStateData(),pb=Object.assign({},ob);aa.updateDetailState(z.DETAIL.COMPOSE_MAIN,Object.assign(pb,{start:true,thread_id:(void 0)}));},nb=function(){var ob=aa.getCurrentStateData(),pb=Object.assign({},ob);aa.updateMasterState(z.MASTER.RECENT_THREADS,Object.assign(pb,{folder:u.INBOX,filter:u.UNREAD}));};k.setContent(lb._noSelectedConversation,ga.render(na._("Keine Unterhaltung ausgew\u00e4hlt"),[{text:na._("Neue Nachricht"),handler:mb},{text:na._("Ungelesene Nachrichten anzeigen"),handler:nb}]));lb._builtNoSelectionBox=true;}function kb(lb){var mb=lb._manager._flexArea.getScrollableArea(),nb=lb._manager.getFlexAreaBoundingClientRect();l.inform('messengerScrolled/'+lb._threadID,{scrollTop:mb.getScrollTop(),top:nb.y,viewHeight:nb.height});}e.exports=sa;},null);
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;},null);
__d("FormSubmitOnChange",["Event","submitForm"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){"use strict";this._form=j;}i.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};i.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};i.prototype._submit=function(){"use strict";h(this._form.getRoot());};Object.assign(i.prototype,{_listener:null});e.exports=i;},null);