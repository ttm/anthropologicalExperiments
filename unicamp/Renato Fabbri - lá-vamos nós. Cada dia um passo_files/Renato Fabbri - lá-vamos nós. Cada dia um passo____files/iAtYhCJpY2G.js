/*!CK:1224148766!*//*1436996605,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["PiKWy"]); }

__d("MercurySendMessageFields",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CONTAIN:"s",COVER:"p"};},null);
__d("ChatSidebarActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({INIT:null,HIDE:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null}),j={Types:i,init:function(){g.dispatch({type:i.INIT});},loaded:function(){g.dispatch({type:i.LOADED});},disable:function(){g.dispatch({type:i.SET_ENABLED,enabled:false});},enable:function(){g.dispatch({type:i.SET_ENABLED,enabled:true});},hide:function(){g.dispatch({type:i.HIDE});},show:function(){g.dispatch({type:i.SHOW});},toggle:function(){g.dispatch({type:i.TOGGLE});}};e.exports=j;},null);
__d("ChatOptions",["Arbiter","ChannelConstants","ChatSidebarActions","JSLogger","PresenceUtil","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=j.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=Object.assign(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(o==='sidebar_mode'){p?i.enable():i.disable();return;}if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===k.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(j.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","SearchableEntry","ShortProfiles","WorkModeConfig","createArrayFromMixed","isValidUniqueID","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=[],o=[],p={},q=[],r={},s=[],t={contains:function(u){return u in p;},getList:function(){if(k.is_work_user)return l(n);t.reRank();var u=l(n);u=u.filter(function(v){var w=j.getNowUnsafe(v);return !w||w.type=="friend";});return u;},getSearchableEntries:function(u,v){var w=t.getList();j.getMulti(w.slice(0,u),function(x){var y=[];for(var z in x)y.push(t.normalizeProfileEntry(x[z]));var aa=t.getGroups().map(t.normalizeThreadEntry);v(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});},normalizeProfileEntry:function(u){var v=u.searchTokens||[];return new i({uniqueID:u.id,keywordString:v.join(' '),order:t.getRank(u.id),photo:u.thumbSrc,title:u.name,type:u.type,uri:u.uri,auxiliaryData:{isMessengerUser:u.is_messenger_user}});},normalizeThreadEntry:function(u,v){var w=u.mercury_thread,x=u.participants_to_render,y=u.text,z=null;if(!y)y=w.name;var aa=x.map(function(ca){return ca.name;}).join(', ');if(!y){y=aa;}else z=aa;var ba=u.uid;if(!y||!m(ba))return null;return new i({uniqueID:ba,order:v,photo:w.image_src,title:y,subtitle:z,type:'thread',auxiliaryData:{participantsToRender:x,thread:w}});},getRank:function(u){return u in p?p[u]:n.length;},getActiveList:function(){if(q.length>0)return q;return t.getList();},getActiveRank:function(u){return u in r?r[u]:t.getRank(u);},reRank:function(){n=[];var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(h.get(w)==x){n[u]=w;p[w]=u++;}});},rankActive:function(){var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(x==g.ACTIVE){q[u]=w;r[w]=u++;}});},getGroups:function(){return o;}};(function(){var u=b('InitialChatFriendsList');n=u.list.length?u.list:[];o=u.groups||[];if(!k.is_work_user){s=n.slice();t.rankActive();t.reRank();}else n.forEach(function(v,w){p[v]=w;});})();e.exports=a.OrderedFriendsList||t;},null);
__d("ChatTabActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),j={Types:i,closeTab:function(k,l){g.dispatch({actionType:i.CLOSE_TAB,reason:l,threadID:k});},closeAllTabs:function(){g.dispatch({actionType:i.CLOSE_ALL_TABS});},closeFragileTabs:function(){g.dispatch({actionType:i.CLOSE_FRAGILE_TABS});},lowerTab:function(k){g.dispatch({actionType:i.LOWER_TAB,threadID:k});},openFragileTab:function(k){g.dispatch({actionType:i.OPEN_FRAGILE_TAB,threadID:k});},openTab:function(k){g.dispatch({actionType:i.OPEN_TAB,threadID:k});},persistLocalState:function(){g.dispatch({actionType:i.PERSIST_LOCAL_STATE});},promoteTab:function(k){g.dispatch({actionType:i.PROMOTE_TAB,threadID:k});},raiseTab:function(k,l,m){g.dispatch({actionType:i.RAISE_TAB,signatureID:m,threadID:k,userAction:l});}};e.exports=j;},null);
__d("PureStoreBasedStateMixin",["StoreBasedStateMixinHelper","invariant","setImmediate"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=function(){for(var k=[],l=0,m=arguments.length;l<m;l++)k.push(arguments[l]);return {getInitialState:function(){return this.constructor.calculateState();},componentWillMount:function(){h(this.constructor.calculateState);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new g(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=i(n);}.bind(this));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);e.exports=j;},null);
__d("formatDate",["DateStrings","DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(o,p,q){q=q||{};if(!p||!o)return '';if(typeof o==='string')o=parseInt(o,10);if(typeof o==='number')o=new Date(o*1000);j(o instanceof Date);j(!isNaN(o.getTime()));j(o.getTime()<1e+15);if(typeof p!=='string'){var r=m();for(var s in r){var t=r[s];if(t.start<=o.getTime()&&p[t.name]){p=p[t.name];break;}}}var u;if(q.skipPatternLocalization||(!q.formatInternal&&n())||p.length===1){u=p;}else{j(h.formats[p]);u=h.formats[p];}var v=q.utc?'getUTC':'get',w=o[v+'Date'](),x=o[v+'Day'](),y=o[v+'Month'](),z=o[v+'FullYear'](),aa=o[v+'Hours'](),ba=o[v+'Minutes'](),ca=o[v+'Seconds'](),da=o[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=l(w,2);break;case 'j':ea+=w;break;case 'S':ea+=g.getOrdinalSuffix(w);break;case 'D':ea+=g.getWeekdayNameShort(x);break;case 'l':ea+=g.getWeekdayName(x);break;case 'F':case 'f':ea+=g.getMonthName(y+1);break;case 'M':ea+=g.getMonthNameShort(y+1);break;case 'm':ea+=l(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+=i._("vormittags");}else ea+=i._("nachmittags");break;case 'A':if(aa<12){ea+=i._("Morgens");}else ea+=i._("Nachmittags");break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=l(aa%12,2);break;case 'H':ea+=l(aa,2);break;case 'i':ea+=l(ba,2);break;case 's':ea+=l(ca,2);break;case 'X':ea+=l(da,3);break;default:ea+=ga;}}return ea;}function l(o,p){return Array(p-(''+o).length+1).join('0')+o;}function m(){var o=new Date(),p=o.getTime(),q=o.getFullYear(),r=o.getDate()-((o.getDay()-h.weekStart+6)%7),s=new Date(q,o.getMonth()+1,0).getDate(),t=new Date(q,1,29).getMonth()===1?366:365,u=1000*60*60*24;return [{name:'today',start:o.setHours(0,0,0,0)},{name:'withinDay',start:p-u},{name:'thisWeek',start:new Date(o.getTime()).setDate(r)},{name:'withinWeek',start:p-u*7},{name:'thisMonth',start:o.setDate(1)},{name:'withinMonth',start:p-u*s},{name:'thisYear',start:o.setMonth(0)},{name:'withinYear',start:p-u*t},{name:'older',start:-Infinity}];}k.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function n(){if(typeof window==='undefined'||!window||!window.location||!window.location.pathname)return false;var o=window.location.pathname,p='/intern';return o.substr(0,p.length)===p;}e.exports=k;},null);
__d("FluxStore",["EventEmitter","invariant"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i='change';function j(k){var l=this.constructor;this.__className=l.name;this.__changed=false;this.__dispatcher=k;this.__changeEvent=this.$FluxStore0();this.__emitter=new g();this.$FluxStore1=k.register(function(m){this.__invokeOnDispatch(m);}.bind(this));}j.prototype.addListener=function(k){return this.__emitter.addListener(this.__changeEvent,k);};j.prototype.getDispatcher=function(){return this.__dispatcher;};j.prototype.getDispatchToken=function(){return this.$FluxStore1;};j.prototype.hasChanged=function(){h(this.__dispatcher.isDispatching());return this.__changed;};j.prototype.__emitChange=function(){h(this.__dispatcher.isDispatching());this.__changed=true;};j.prototype.__invokeOnDispatch=function(k){this.__changed=false;this.__onDispatch(k);if(this.__changed)this.__emitter.emit(this.__changeEvent);};j.prototype.__onDispatch=function(k){h(false);};j.prototype.$FluxStore0=function(){return i;};e.exports=j;},null);
__d("keyMirrorRecursive",["invariant"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(k,l){return i(k,l);}function i(k,l){var m={},n;g(j(k));for(n in k){if(!k.hasOwnProperty(n))continue;var o=k[n],p=l?l+'.'+n:n;if(j(o)){o=i(o,p);}else o=p;m[n]=o;}return m;}function j(k){return k instanceof Object&&!Array.isArray(k);}e.exports=h;},null);
__d("mergeDeepInto",["invariant","mergeHelpers"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h.ArrayStrategies,j=h.checkArrayStrategy,k=h.checkMergeArrayArgs,l=h.checkMergeLevel,m=h.checkMergeObjectArgs,n=h.isTerminal,o=h.normalizeMergeArg,p=function(t,u,v,w){m(t,u);l(w);var x=u?Object.keys(u):[];for(var y=0;y<x.length;y++){var z=x[y];r(t,u,z,v,w);}},q=function(t,u,v,w){k(t,u);l(w);var x=Math.max(t.length,u.length);for(var y=0;y<x;y++)r(t,u,y,v,w);},r=function(t,u,v,w,x){var y=u[v],z=u.hasOwnProperty(v),aa=z&&n(y),ba=z&&Array.isArray(y),ca=z&&!ba&&!ba,da=t[v],ea=t.hasOwnProperty(v),fa=ea&&n(da),ga=ea&&Array.isArray(da),ha=ea&&!ga&&!ga;if(fa){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else if(!z)t[v]=da;}else if(ga){if(aa){t[v]=y;}else if(ba){g(i[w]);if(w===i.Clobber)da.length=0;q(da,y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;}else if(ha){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){p(da,y,w,x+1);}else !z;}else if(!ea)if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;},s=function(t,u,v){var w=o(u);j(v);p(t,w,v,0);};e.exports=s;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={generateMessageID:function(k){var l=k||Date.now(),m=h(0,4294967295),n=g.getSessionID();return ("<"+l+":"+m+"-"+n+"@mail.projektitan.com>");},generateThreadID:function(k){return 'root:'+i.generateMessageID(k);},generateOfflineThreadingID:function(k){var l=k||Date.now(),m=h(0,4294967295),n=('0000000000000000000000'+m.toString(2)).slice(-22),o=l.toString(2)+n;return j(o);}};function j(k){var l='';while(k!='0'){var m=0,n='';for(var o=0;o<k.length;o++){m=2*m+parseInt(k[o],10);if(m>=10){n+='1';m-=10;}else n+='0';}l=m.toString()+l;k=n.slice(n.indexOf('1'));}return l;}e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute=q._("Heute");v.threading_id=v.threading_id||j.generateMessageID(v.timestamp);v.offline_threading_id=v.offline_threading_id||j.generateOfflineThreadingID(v.timestamp);v.message_id=v.message_id||v.threading_id;var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';function l(m){this.$MercuryMessageActions0=m;this.$MercuryMessageActions1=h.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=j.getForFBID(this.$MercuryMessageActions0);}l.prototype.send=function(m,n,o){n=n||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(m);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},m),i.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(m,o);n(m.thread_id);};l.prototype.resend=function(m,n){var o=Object.assign({},m);this.$MercuryMessageActions1.normalizeResendMessage(o);this.send(o,(void 0),n);};l.prototype.addAttachmentPlaceholder=function(m,n,o){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(m,n,o);this.$MercuryMessageActions1.normalizeNewMessage(m);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},m),i.CLIENT_SEND_MESSAGE));};l.prototype.cancelAttachmentPlaceholder=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:m,upload_data:n,action_type:g.CANCEL_ATTACHMENT_PLACEHOLDER},i.CLIENT_SEND_MESSAGE));};l.prototype.confirmAttachmentPlaceholder=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:m,upload_data:n,action_type:g.CONFIRM_ATTACHMENT_PLACEHOLDER},i.CLIENT_SEND_MESSAGE));};l.prototype.markSpam=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4(m,n,g.MARK_MESSAGES_SPAM,i.CLIENT_MARK_MESSAGES_SPAM));};l.prototype["delete"]=function(m,n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4(m,n,g.DELETE_MESSAGES,o||i.CLIENT_DELETE_MESSAGES));};l.prototype.$MercuryMessageActions3=function(m,n){return {actions:[m],from_client:true,payload_source:n};};l.prototype.$MercuryMessageActions5=function(m,n){return {actions:[m],from_client:false,payload_source:n};};l.prototype.$MercuryMessageActions4=function(m,n,o,p){return {actions:[{action_type:o,action_id:null,thread_id:m,message_ids:n}],from_client:true,payload_source:p};};Object.assign(l,k);e.exports=l;},null);
__d("MercuryThreadActions",["AsyncDialog","AsyncRequest","MercuryActionType","MercuryIDs","MercuryMessengerBlockingUtils","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();'use strict';function q(r){this.$MercuryThreadActions0=r;this.__serverRequests=m.getForFBID(this.$MercuryThreadActions0);}q.prototype.markRead=function(r,s){this.batchMarkRead([r],s);};q.prototype.batchMarkRead=function(r,s){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(r,true,s));};q.prototype.markUnread=function(r,s){this.batchMarkUnread([r],s);};q.prototype.batchMarkUnread=function(r,s){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(r,false,s));};q.prototype.markSeen=function(r,s){this.__serverRequests.handleUpdate(this.__constructClientPayload([r],i.MARK_THREAD_SEEN,l.CLIENT_MARK_THREAD_SEEN,{persistent:s}));};q.prototype.archive=function(r,s){this.batchArchive([r],s);};q.prototype.batchArchive=function(r,s){r.forEach(function(t){this.__serverRequests.changeThreadArchivedStatus(t,true,s);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(r,true));};q.prototype.unarchive=function(r,s){this.batchUnarchive([r],s);};q.prototype.batchUnarchive=function(r,s){r.forEach(function(t){this.__serverRequests.changeThreadArchivedStatus(t,false,s);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(r,false));};q.prototype.markSpam=function(r,s){this.batchMarkSpam([r],s);};q.prototype.batchMarkSpam=function(r,s){r.forEach(function(t){this.__serverRequests.markThreadSpam(t,s);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(r,o.SPAM));};q.prototype.unmarkSpam=function(r,s){this.batchUnmarkSpam([r],s);};q.prototype.batchUnmarkSpam=function(r,s){r.forEach(function(t){this.__serverRequests.unmarkThreadSpam(t,s);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(r,o.INBOX));};q.prototype.changeFolder=function(r,s){this.batchChangeFolder([r],s);};q.prototype.batchChangeFolder=function(r,s){r.forEach(function(t){this.__serverRequests.changeThreadFolder(t,s);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(r,s));};q.prototype["delete"]=function(r,s){this.batchDelete([r],s);};q.prototype.batchDelete=function(r,s){r.forEach(function(t){this.__serverRequests.deleteThread(t,s);}.bind(this));this.__serverRequests.handleUpdate(this.__constructClientPayload(r,i.DELETE_THREAD,l.CLIENT_DELETE_THREAD));};q.prototype.openNotificationSettings=function(r){this.__serverRequests.openNotificationSettings(r);};q.prototype.unmute=function(r){this.updateMuteSetting(r,0);};q.prototype.updateMuteSetting=function(r,s){this.__serverRequests.changeMutingOnThread(r,s);this.__serverRequests.handleUpdate(this.__constructClientPayload([r],i.CHANGE_MUTE_SETTINGS,l.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:s}));};q.prototype.blockMessages=function(r){var s=JSON.stringify({reportable_ent_token:j.getUserIDFromThreadID(r),initial_action_name:k.block_messages});g.send(new h(new p('/ajax/nfx/messenger_direct_action').addQueryData({story_location:'messenger',context:s})));};q.prototype.unblockMessages=function(r){var s=JSON.stringify({reportable_ent_token:j.getUserIDFromThreadID(r),initial_action_name:k.block_messages});new h(new p('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:s})).send();};q.prototype.addParticipants=function(r,s){this.__serverRequests.handleUpdate(this.__constructClientPayload([r],i.ADD_PARTICIPANTS,l.CLIENT_ADD_PARTICIPANTS,{participants:s}));};q.prototype.unpinThread=function(r){this.__serverRequests.unpinThread(r);this.__serverRequests.handleUpdate(this.__constructClientPayload([r],i.UNPIN_THREAD,l.CLIENT_UNPIN_THREAD));};q.prototype.movePendingToInbox=function(r){this.__serverRequests.handleUpdate(this.__constructClientPayload([r],i.MOVE_PENDING_TO_INBOX,l.CLIENT_MOVE_PENDING_TO_INBOX));};q.prototype.$MercuryThreadActions1=function(r,s,t){return this.__constructClientPayload(r,i.CHANGE_READ_STATUS,l.CLIENT_CHANGE_READ_STATUS,{mark_as_read:s,source:t});};q.prototype.$MercuryThreadActions2=function(r,s){return this.__constructClientPayload(r,i.CHANGE_ARCHIVED_STATUS,l.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:s});};q.prototype.$MercuryThreadActions3=function(r,s){return this.__constructClientPayload(r,i.CHANGE_FOLDER,l.CLIENT_CHANGE_FOLDER,{new_folder:s});};q.prototype.__constructClientPayload=function(r,s,t,u){return {actions:r.map(function(v){return Object.assign({action_type:s,action_id:null,thread_id:v},u);}),from_client:true,payload_source:t};};Object.assign(q,n);e.exports=q;},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l.activity_limit||60000,p=l.idle_limit||1800000,q=l.idle_poll_interval||300000,r=k.create('chat_activity'),s=Date.now(),t=s,u=true;function v(){var z=Date.now();return !!(u&&(z-s<o));}var w=Object.assign(new h(),{isActive:v});function x(){var z=s;s=Date.now();if(s-z>p){r.debug('idle_to_active',z);m.doSync();}w.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())t=Date.now();});g.listen(window,'focus',function(){u=true;x();});g.listen(window,'blur',function(){u=false;});n.subscribe(function(){x();});function y(z){var aa=z&&z.at&&m.verifyNumber(z.at);if(typeof aa!=='number')aa=null;return aa||0;}setInterval(function(){var z=Date.now(),aa=y(m.get()),ba=Math.max(s,aa,t);if(z-ba>p){r.debug('idle',{cookie:aa,local:s,presence:t});w.inform('idle',z-ba);}},q);m.registerStateStorer(function(z){var aa=y(z);if(aa<s)z.at=s;return z;});h.subscribe(k.DUMP_EVENT,function(z,aa){aa.chat_activity={activity_limit:o,idle_limit:p,idle_poll_interval:q,last_active_time:s,last_global_active_time:t};});e.exports=w;},null);
__d("MercuryMessages",["BanzaiODS","EventEmitter","ImmutableObject","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryDispatcher","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","URI","invariant","isMessengerDotComURI","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){b.__markCompiled&&b.__markCompiled();'use strict';var fa=new h(),ga=j.getInstance('mercury_messages');function ha(qa,ra){var sa=ra;if(qa._localIdsMap[ra])sa=qa._localIdsMap[ra];return qa._messages.get(sa);}function ia(qa){switch(qa){case r.UNKNOWN:case r.SERVER_INITIAL_DATA:case r.SERVER_FETCH_THREAD_INFO:case r.SERVER_THREAD_SYNC:return true;}return false;}function ja(qa,ra){if(!qa._threadsToMessages[ra])qa._threadsToMessages[ra]=new v(function(sa){return ha(qa,sa).timestamp;},function(sa,ta){return ta-sa;});return qa._threadsToMessages[ra];}function ka(qa,ra,sa){ra.forEach(function(ta){var ua=ja(qa,ta);ua.setReachedEndOfArray();qa._emitReorderedChange(ta,sa);});}function la(qa){this._fbid=qa;this._messageActions=t.getForFBID(this._fbid);this._serverRequests=x.getForFBID(this._fbid);this._threadInformer=z.getForFBID(this._fbid);this._threads=aa.getForFBID(this._fbid);this._threadActions=y.getForFBID(this._fbid);this._dispatcher=o.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._localIdsMap={};this._dispatcher.subscribe('update-messages',function(ra,sa){var ta=(sa.actions||[]).filter(function(va){var wa=va.action_type,xa=((va.is_forward||va.thread_id)&&(wa==m.LOG_MESSAGE||wa==m.USER_GENERATED_MESSAGE||wa==m.SEND_MESSAGE||wa==m.DELETE_THREAD||wa==m.DELETE_MESSAGES||wa==m.MARK_MESSAGES_SPAM)),ya=((va.upload_id&&va.upload_data)&&(wa==m.CANCEL_ATTACHMENT_PLACEHOLDER||wa==m.CONFIRM_ATTACHMENT_PLACEHOLDER));return xa||ya;}),ua=ia(sa.payload_source);this.handleUpdates(ta,ua,sa.payload_source,sa.from_client);if(sa.end_of_history)ka(this,sa.end_of_history,sa.payload_source);if(this._didChange){this._didChange=false;fa.emit('change');}}.bind(this));ga.debug('constructed',{fbid:this._fbid});}Object.assign(la.prototype,{getMessagesFromIDs:function(qa){return (qa||[]).map(ha.bind(null,this)).filter(function(ra){return ra;});},hasLoadedNMessages:function(qa,ra){var sa=ja(this,qa);return sa.hasReachedEndOfArray()||sa.getCurrentArraySize()>=ra;},hasLoadedExactlyNMessages:function(qa,ra){var sa=ja(this,qa);return sa.getCurrentArraySize()==ra;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._localIdsMap={};},getThreadMessagesRange:function(qa,ra,sa,ta,ua,va){var wa=ja(this,qa),xa=function(hb){ta(ma(this,hb));}.bind(this),ya=wa.executeOrEnqueue(ra,sa,xa),za=wa.getUnavailableResources(ya),ab=this._failedHistoryFetchThreads[qa];if(za.length&&!ab){var bb=wa.getCurrentArraySize(),cb=this._localTitanMessagesCount[qa]||0,db=bb-cb,eb=za.length+cb,fb=this.getCurrentlyLoadedMessages(qa),gb=fb.length?fb[0].timestamp:0;ga.debug('fetch_missing_messages',{threadID:qa,offset:ra,limit:sa,timestamp:gb,missingIndices:za,messageCount:bb,localMessageCount:cb});this._serverRequests.fetchThreadMessages(qa,db,eb,gb,ua,va);}else this._failedHistoryFetchThreads[qa]=false;return ya;},getThreadMessagesRangeNow:function(qa,ra,sa){var ta=ja(this,qa),ua=[];for(var va=ra;va<ra+sa;va++){var wa=ta.getResourceAtIndex(va),xa=ha(this,wa);xa&&ua.push(xa);}return ua;},getThreadMessagesSinceTimestamp:function(qa,ra){var sa=ja(this,qa),ta=sa.getElementsUntil(ra);return ma(this,ta);},hasLoadedAllMessages:function(qa){return ja(this,qa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(qa){var ra=ja(this,qa).getAllResources();return ma(this,ra);},unsubscribe:function(qa,ra){n.isThreadID(ra);var sa=ja(this,ra);sa.unsubscribe(qa);},_addNewMessage:function(qa,ra){pa(ra);this._messages.set(qa,new i(ra));},_updateMessage:function(qa,ra,sa){var ta=i.set(ra,sa);this._messages.set(qa,ta);return ta;},_shouldSortOutOfOrderMessages:function(qa,ra,sa){if(qa==r.CLIENT_CHANNEL_MESSAGE){var ta=this.getThreadMessagesSinceTimestamp(ra,sa);if(ta.length>0){g.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(qa,ra){var sa=qa.action_type;if(ra==r.CLIENT_CHANNEL_MESSAGE&&sa==m.USER_GENERATED_MESSAGE&&qa.threading_id&&this._localIdsMap[qa.threading_id]===qa.threading_id){qa.client_message_id=qa.threading_id;qa.status=l.SUCCESS;qa.action_type=m.SEND_MESSAGE;sa=qa.action_type;}if(ra===r.CLIENT_CHANNEL_MESSAGE&&sa==m.USER_GENERATED_MESSAGE){var ta=this._threads.getThreadMetaNow(qa.thread_id);if(ta&&ta.folder)qa.folder=ta.folder;}return qa;},handleUpdates:function(qa,ra,sa,ta){var ua,va={},wa={};for(var xa=0;xa<qa.length;xa++){var ya=this._preprocessIncomingAction(qa[xa],sa),za=ya.action_type,ab=ha(this,ya.message_id);if(ya.is_forward||sa==r.SERVER_SEARCH){if(!this._messages.has(ya.message_id))this._addNewMessage(ya.message_id,ya);continue;}else if(ya.client_state===q.SEND_TO_SERVER){this._addNewMessage(ya.message_id,ya);continue;}else if(za==m.SEND_MESSAGE){var bb=ya.client_message_id;if(bb&&this._localIdsMap[bb]&&ya.status){var cb=ha(this,bb),db=cb.status;if(cb.status==l.SUCCESS)continue;if(ya.status==l.UNCONFIRMED){if(!wa[ya.thread_id])wa[ya.thread_id]=[];wa[ya.thread_id].push(bb);}else if(!va[ya.thread_id])va[ya.thread_id]=[];this._updateLocalMessage(ya);if(typeof db!==(void 0)||ya.status==l.FAILED_UNKNOWN_REASON||ya.status==l.UNABLE_TO_CONFIRM||ya.status==l.SUCCESS||ya.status==l.ERROR)this._emitUpdatedChange(ya.thread_id,ha(this,bb).message_id,sa);}continue;}else if(za==m.DELETE_THREAD){ja(this,ya.thread_id).removeAllResources();continue;}else if(za==m.DELETE_MESSAGES){this._deleteMessages(ya.thread_id,ya.message_ids,sa);continue;}else if(za===m.MARK_MESSAGES_SPAM){this._markMessagesSpam(ya,sa);continue;}else if((ya.threading_id&&this._localIdsMap[ya.threading_id])||(ab&&!ab.is_forward)){if(ab&&ya.ranges&&ya.ranges.length>0){var eb=ab.message_id;this._updateMessage(this._localIdsMap[eb]||eb,ab,{ranges:qa.ranges});this._emitUpdatedChange(ab.thread_id,ab.message_id,'link_shim');}continue;}else if(za===m.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(ya.upload_id,ya.upload_data);continue;}else if(za===m.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(ya.upload_id,ya.upload_data);continue;}else{if(sa===r.CLIENT_SEND_MESSAGE){this._localIdsMap[ya.message_id]=ya.message_id;if(ya.thread_id=='root:'+ya.message_id)ja(this,ya.thread_id).setReachedEndOfArray();}if(za==m.LOG_MESSAGE&&ya.log_message_type==p.SERVER_ERROR)this._failedHistoryFetchThreads[ya.thread_id]=true;if(ya.client_state===q.DO_NOT_SEND_TO_SERVER&&ya.upload_id)this._uploadMessages[ya.upload_id]=ya;if(!va[ya.thread_id])va[ya.thread_id]=[];va[ya.thread_id].push(ya.message_id);this._addNewMessage(ya.message_id,ya);if(ya.threading_id&&ya.threading_id!=ya.message_id)u.addServerID(ya.threading_id,ya.message_id);if(ya[w.MANUAL_RETRY_CNT]>0){ua=ja(this,ya.thread_id);ua.resortResources([ya.message_id]);this._emitReorderedChange(ya.thread_id,r.CLIENT_SEND_MESSAGE);}ra=ra||this._shouldSortOutOfOrderMessages(sa,ya.thread_id,ya.timestamp);if(!ra)this._emitReceivedChange(ha(this,ya.message_id));continue;}}for(var fb in va){ua=ja(this,fb);var gb=ua.getAllResources(),hb=gb.filter(function(jb){var kb=this._messages.get(jb);return kb.action_type==m.LOG_MESSAGE&&kb.log_message_type==p.SERVER_ERROR;}.bind(this));ua.removeResources(hb);if(ta)na(this,fb,va[fb]);if(ra){ua.addResources(va[fb]);this._emitReorderedChange(fb,sa);}else ua.addResourcesWithoutSorting(va[fb].reverse(),0);this._threadInformer.updatedThread(fb);}var ib=Object.keys(wa);if(ib.length)this._serverRequests.requestMessageConfirmation(wa);this._didChange&&ga.debug('handle_updates',{localMessageCounts:ea(this._localTitanMessagesCount)});},isFirstMessage:function(qa){var ra=ja(this,qa.thread_id);if(ra.getCurrentArraySize()===0)return false;var sa=ra.getResourceAtIndex(ra.getCurrentArraySize()-1),ta=ha(this,sa).message_id,ua=ha(this,qa.message_id).message_id;return ra.hasReachedEndOfArray()&&ta==ua;},_markMessagesSpam:function(qa,ra){var sa=qa,ta=sa.thread_id,ua=sa.message_ids;if(!ua.length)return;this._deleteIndividualMessages(ta,ua,ra);this._serverRequests.markMessagesSpam(ta,ua);},_deleteMessages:function(qa,ra,sa){if(!ra.length)return;this._deleteIndividualMessages(qa,ra,sa);if(sa!==r.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(qa,ra);},_deleteIndividualMessages:function(qa,ra,sa){var ta=ra.map(function(va){return ha(this,va).message_id;},this),ua=ja(this,qa);ua.removeResources(ta);this._emitReorderedChange(qa,sa);},_updateLocalMessage:function(qa){var ra=ha(this,qa.client_message_id),sa={};sa.status=qa.status;if(qa.status===l.SUCCESS||qa.error_data)sa.error_data=qa.error_data;var ta=qa.message_id,ua=qa.client_message_id;if(this._messages.has(ta)){this._updateMessage(ta,ra,sa);return false;}if(qa.timestamp)sa.timestamp=qa.timestamp;if(qa.log_message_data)sa.log_message_data=qa.log_message_data;if(qa.ranges&&qa.ranges.length){pa(qa);sa.ranges=qa.ranges;}if(qa.attachments&&qa.attachments.length){sa.raw_attachments=null;sa.attachments=qa.attachments;}this._localIdsMap[ua]=ta;u.addServerID(ua,ta);var va=this._updateMessage(ta,ra,sa);this._messages.set(ua,new i());if(oa(va))this._localTitanMessagesCount[va.thread_id]--;return true;},getNumberLocalMessages:function(qa){return this._localTitanMessagesCount[qa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(qa,ra){var sa=this._popPendingAttachmentMessage(qa,ra);this._serverRequests.sendNewMessage(sa);},_cancelAttachmentPlaceholder:function(qa,ra){var sa=this._popPendingAttachmentMessage(qa,ra);this._deleteIndividualMessages(sa.thread_id,[sa.message_id]);if(this._localTitanMessagesCount[sa.thread_id])this._localTitanMessagesCount[sa.thread_id]--;},_popPendingAttachmentMessage:function(qa,ra){var sa=this._uploadMessages[qa];ca(sa);sa.image_ids=ra.image_ids;sa.file_ids=ra.file_ids;sa.audio_ids=ra.audio_ids;sa.gif_ids=ra.gif_ids;sa.client_state=q.SEND_TO_SERVER;delete this._uploadMessages[qa];return sa;},_emitUpdatedChange:function(qa,ra,sa){this._didChange=true;this._threadInformer.updatedMessage(qa,ra,sa);},_emitReceivedChange:function(qa){this._didChange=true;this._threadInformer.receivedMessage(qa);},_emitReorderedChange:function(qa,ra){this._didChange=true;this._threadInformer.reorderedMessages(qa,ra);}});Object.assign(la,s,{addListener:function(qa,ra){return fa.addListener(qa,ra);}});function ma(qa,ra){var sa=ra.map(ha.bind(null,qa));return sa.reverse();}function na(qa,ra,sa){var ta=sa.filter(function(ua){return oa(ha(qa,ua));});if(!qa._localTitanMessagesCount[ra])qa._localTitanMessagesCount[ra]=0;qa._localTitanMessagesCount[ra]+=ta.length;}function oa(qa){var ra=qa.action_type;if(ra==m.USER_GENERATED_MESSAGE)return true;switch(qa.log_message_type){case p.SUBSCRIBE:case p.UNSUBSCRIBE:case p.SERVER_ERROR:case p.LIVE_LISTEN:return false;default:return true;}}function pa(qa){if(!qa.ranges)return;qa.ranges.forEach(function(ra){if(!ra.entity||ra.entity.external||!ra.entity.url)return;var sa=new ba(ra.entity.url);if(da(ba.getRequestURI())&&!sa.getDomain()){sa.setProtocol('https').setDomain('www.facebook.com');ra.entity.url=sa.toString();}});}e.exports=la;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}m.prototype.setFBID=function(q){"use strict";this._request.fbid=q;return this;};m.prototype.setType=function(q){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],q))throw new TypeError('ImageSourceRequest.setType: invalid type '+q);this._request.type=q;return this;};m.prototype.setDimensions=function(q,r){"use strict";this._request.width=q;this._request.height=r;return this;};m.prototype.setResizeMode=function(q){"use strict";if(!l([j.COVER,j.CONTAIN],q))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+q);this._request.resize_mode=q;return this;};m.prototype.setCallback=function(q){"use strict";this._callback=q;return this;};m.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var q=o(),r=p(this._request);q.executeOrEnqueue(r,this._callback);if(q.getUnavailableResourcesFromRequest(r).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var n=null;function o(){if(n)return n;var q=new i();n=q;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(r,s){var t;(t=r.requests).push.apply(t,s.requests);return r;},handler:function(r,s){var t=s.getData().requests;for(var u=0;u<t.length;++u)q.setResource(p(t[u]),r[u]);}}});return q;}function p(q){return [q.fbid,q.type,q.width,q.height,q.resize_mode].join('|');}e.exports=m;},null);
__d("MercuryParticipantFetcher",["LogHistory","MercuryIDs","MercuryPayloadSource","MercuryServerRequests","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=g.getInstance('short_profiles');function o(q){this.$MercuryParticipantFetcher0=j.getForFBID(q);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new k();this.$MercuryParticipantFetcher3=new k();}o.prototype.fetch=function(q){this.$MercuryParticipantFetcher4(q);this.$MercuryParticipantFetcher5();};o.prototype.fetchMulti=function(q){q.forEach(function(r){return this.$MercuryParticipantFetcher4(r);}.bind(this));this.$MercuryParticipantFetcher5();};o.prototype.$MercuryParticipantFetcher4=function(q){if(!this.$MercuryParticipantFetcher3.has(q))this.$MercuryParticipantFetcher2.add(q);};o.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;m(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(q){return this.$MercuryParticipantFetcher3.add(q);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(q){q.forEach(function(r){return this.$MercuryParticipantFetcher3["delete"](r.id);}.bind(this));this.$MercuryParticipantFetcher7(q);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};o.prototype.$MercuryParticipantFetcher6=function(q,r){var s=[];q.forEach(function(t){var u=h.tokenize(t),v=u.type,w=u.value;v==='fbid'&&s.push(w);});if(s.length>0){l.getMulti(s,function(t){var u=[];for(var v in t)u.push(p(t[v],v));r(u);if(u.length!==s.length)n.error('server_fetch_participant_count_error',{expectedIDs:s,receivedIDs:Object.keys(t)});});n.debug('client_fetch_participants',{userIDs:s});}};o.prototype.$MercuryParticipantFetcher7=function(q){this.$MercuryParticipantFetcher0.handleUpdate({participants:q,from_client:false,payload_source:i.SERVER_FETCH_PARTICIPANTS});};function p(q,r){var s=Object.assign({gender:q.gender,fbid:q.id||r,href:q.uri,id:h.getParticipantIDFromUserID(q.id||r),image_src:q.thumbSrc,name:q.name,short_name:q.firstName,employee:q.employee,is_employee_away:q.is_employee_away,type:q.type,vanity:q.vanity,is_friend:q.is_friend,is_messenger_user:q.is_messenger_user,social_snippets:q.social_snippets},{});if(q.officeStatus){s.officeStatus=q.officeStatus;s.officeStatusStartDate=q.officeStatusStartDate;s.officeStatusEndDate=q.officeStatusEndDate;s.officeStatusComment=q.officeStatusComment;s.officeStatusLocation=q.officeStatusLocation;}return s;}e.exports=o;},null);
__d("MercuryVanityIDMap",["Map","MercuryAssert"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=new g(),j=new g(),k={getID:function(l){return i.get(l);},getVanity:function(l){return j.get(l);},hasID:function(l){return j.has(l);},hasVanity:function(l){return i.has(l);},set:function(l,m){h.isParticipantID(m);i.set(l,m);j.set(m,l);}};e.exports=k;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryDispatcher","MercuryVanityIDMap","PhotoResizeModeConst","Set","createObjectFrom","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new o(this.$MercuryParticipants0);this.$MercuryParticipants4=r.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants4.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0)this.$MercuryParticipants5(ca.participants);}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return null;if(s.hasVanity(aa))return s.getID(aa);if(/^\d+$/.test(aa))return n.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants6(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants6(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){m.isParticipantID(aa);return this.$MercuryParticipants7([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants7(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){m.allParticipantIDs(aa);var ca=q.BIG_IMAGE_SIZE;return this.$MercuryParticipants7(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants8(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(n.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants7=function(aa,ba){m.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=n.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipants9(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsa(ca);};y.prototype.$MercuryParticipants6=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=n.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipants9(aa,ea);}return ba;};y.prototype.$MercuryParticipants9=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants8=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants5=function(aa){var ba=aa.map(function(ca){return ca.id;});aa=aa.map(function(ca){if(ca.vanity)s.set(ca.vanity,ca.id);var da=this.$MercuryParticipants2.getResource(ca.id);return da?k.set(da,ca):new k(this.$MercuryParticipantsb(ca));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(v(ba,aa));this.$MercuryParticipants8(new u(ba));};y.prototype.$MercuryParticipantsb=function(aa){var ba=aa.type===p.USER||aa.type===p.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca=w._("Facebook-Nutzer");aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsa=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:q.UNKNOWN_GENDER,href:null,id:aa,image_src:q.EMAIL_IMAGE,big_image_src:q.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i='fbid:'+g.getID(),j={getID:function(){return i;},isViewer:function(k){h.isParticipantID(k);return k===i;}};e.exports=j;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} hat {groupName} eine Nachricht geschickt",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} hat dir eine Nachricht geschickt",[j.param("name",s.short_name)]));});}else o(j._("Neue Nachricht!"));});});}e.exports={renderDocumentTitle:m};},null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryDispatcher"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){this._fbid=l;this._dispatcher=j.getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',function(m,n){if(!n.actions||!n.actions.length)return;if(n.payload_source==h.CLIENT_SEND_MESSAGE||n.payload_source==h.UNKNOWN)return;for(var o=0;o<n.actions.length;o++){var p=n.actions[o],q=p.action_type;if(q==g.USER_GENERATED_MESSAGE&&p.thread_id&&p.timestamp>this._lastTimestamp)this._lastTimestamp=p.timestamp;}}.bind(this));}Object.assign(k.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(k,i);e.exports=k;},null);
__d("ChatTitleBarBlinker",["ChatActivity","ChatConfig","DocumentTitle","FavIcon","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=b('MercuryThreadInformer').get(),o=b('MercuryTimestampTracker').get(),p=k.create('chat_title'),q=null,r=0,s=false;if(h.get('unreadFavicon'))j.setToggleResources(h.get('unreadFaviconURL'));function t(){if(q){q.stop();q=null;return true;}return false;}function u(z){var aa=z||o.getLastUserMessageTimestamp();if(r<=aa){r=aa;if(t()||s)m.doSync();}if(h.get('unreadFavicon')&&j.isToggledResource())j.toggle();}var v={blink:function(z,aa){if(!q&&r<aa)l.renderDocumentTitle(z,function(ba){if(!q)q=i.blink(ba);});},stopBlinking:function(){u();},blinkingElsewhere:function(){s=true;}};function w(z){var aa=m.verifyNumber(z.sb2);if(!aa||aa<=r)return null;return aa;}function x(z){var aa=z&&w(z);if(aa){r=aa;p.debug('load',r);t();s=false;}}function y(z){var aa=w(z);if(!aa){p.debug('store',r);z.sb2=r;s=false;}return z;}m.registerStateStorer(y);m.registerStateLoader(x);n.subscribe('thread-read-changed',function(z,aa){var ba=o.getLastUserMessageTimestamp(),ca=0;for(var da in aa)if(aa[da].mark_as_read&&aa[da].timestamp>=ba&&aa[da].timestamp>ca)ca=aa[da].timestamp;ca&&u(ca);});g.subscribe('activity',function(){u();});(function(){var z=m.getInitial();if(z)r=w(z)||0;})();e.exports=v;},null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","isFacebookURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=null,o={init:function(s){if(!n)h.init(s);},play:function(s,t,u){if(n){i.playRemote(n.contentWindow,s,t,false);}else i.playLocal(s,t,u);},stop:function(s){if(!n)h.stop(s);}},p=new k(location.href);if(p.getSubdomain()&&p.getSubdomain()!=='www')p.setSubdomain('www');var q=p.getDomain();function r(){if(l.ie()<9)return false;if(g.RPC_DISABLED)return false;return j.isSupported()&&i.supportsRPC();}if(m(p)&&location.host!==q&&r()){n=document.createElement('iframe');n.setAttribute('src','//'+q+'/sound_iframe.php');n.style.display='none';document.body.appendChild(n);}e.exports=o;},null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryThreadInfo","MercuryIDs","MercuryConfig","MercuryViewer","MessagingTag","ShortProfiles","Sound","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function t(v){if(j.getSetting('sound'))r.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],v,false);}var u={messageReceived:function(v){if(o.isViewer(v.author)||!v.is_unread||(v.folder!=p.INBOX&&v.folder!=p.ARCHIVED))return;var w=v.thread_id,x=h.isActive();if(x){var y=false;u.inform('before-alert',{threadID:w,cancelAlert:function(){y=true;}});}s.getThreadMeta(w,function(z){var aa=l.isMuted(z),ba=m.getUserIDFromParticipantID(o.getID());q.get(ba,function(ca){var da=(new RegExp('@'+ca.firstName,'i')).test(v.body);if(aa&&(!n.GroupChatMentionsGK||!da))return;var ea=v.timestamp;if(x){!y&&t(ea);}else{k.blink(w,ea);t(ea);}k.blinkingElsewhere();});}.bind(this));}};e.exports=Object.assign(u,g);},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={init:function(){g.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(i,j,k){var l=k.getInstance();i.subscribe(i.SEND,function(){j.logSavedSummaries(l);});});}};e.exports=h;},null);
__d("FBRTCAvailability",["ChannelConstants","PresenceStatus"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={isCallable:function(j){var k=h.getCapabilities(j),l=g.CAPABILITY_VOIP_INTEROP|g.CAPABILITY_VIDEO;return !!(k&l);}};e.exports=i;},null);
__d("FBRTCStruct",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=function(i,j,k){var l,m;if(typeof i=='string'||i instanceof String){m=i;l=i;}else for(var n in i)if(i.hasOwnProperty(n))if(n==='index'){k=i[n];}else{m=n;l=i[n];}j[m]=k;j.strNames[k]=l;};function h(i){"use strict";this.strNames=[];for(var j=0;j<i.length;j++)g(i[j],this,j);}e.exports=h;},null);
__d("FBRTCConstants",["FBRTCStruct"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',SDP_UPDATE:'sdp_update',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video',VIDEO_REQUEST:'video_request',ACK:'ack'},i=new g([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),j={TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,START_CALL:9,OPEN_SCREEN_IN_NEW:10},k={PayloadType:h,CallEndReason:i,UIEventType:j,endCallReasonFromString:function(l){return i.strNames.indexOf(l);},callEndReasonString:function(l){if(l<0||l>i.strNames.length)return 'Unknown';return i.strNames[l];},fullCallEndReasonString:function(l,m){return this.callEndReasonString(l)+'_'+(m?'remote':'local');}};e.exports=k;},null);
__d("FBRTCIceStatsParser",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g=null;h.getInstance=function(){"use strict";if(!g)g=new h();return g;};function h(){"use strict";}h.prototype.extractIceInfo=function(i){"use strict";var j=[],k=i.split("\r\n");for(var l=0;l<k.length;l++){var m=k[l];if(this.$FBRTCIceStatsParser0(m))j.push({gen:this.$FBRTCIceStatsParser1(m),type:this.$FBRTCIceStatsParser2(m)});}return j;};h.prototype.$FBRTCIceStatsParser0=function(i){"use strict";return (i.indexOf('candidate:')>-1);};h.prototype.$FBRTCIceStatsParser1=function(i){"use strict";var j=0,k=i.match(/generation (\d+)/);if(k)j=parseInt(k[1],10);return j;};h.prototype.$FBRTCIceStatsParser2=function(i){"use strict";var j=i.match(/typ (host|relay|srflx|prflx)/);if(j){return j[1];}else return 'unknown';};e.exports=h;},null);
__d("FBRTCLogger",["Log","LogHistory","MarauderLogger","formatDate","pageID"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l='webrtc',m='sent_message',n='received_message',o='send_succeeded',p='send_failed',q='info',r='call_action',s='client_event',t='client_error',u='type',v='msg_id',w='ack_msg_id',x='call_id',y='from',z='to',aa='content',ba='tag',ca='peer_id',da='error_code',ea='trigger',fa='endcallstats',ga=null;ha.getInstance=function(){"use strict";if(!ga)ga=new ha();return ga;};function ha(){"use strict";this.$FBRTCLogger0=h.getInstance(l);}ha.prototype.logToConsole=function(ia){"use strict";var ja='Console';this.$FBRTCLogger1(null,null,ja,ia);this.$FBRTCLogger0.log(ja,ia);};ha.prototype.logReceivedMessage=function(ia,ja,ka){"use strict";var la={};la[y]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(n,la);this.$FBRTCLogger1(ia,ja,'Received',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessage=function(ia,ja,ka){"use strict";var la={};la[z]=ia;la[x]=ja;la[u]=ka.type;la[v]=ka.msg_id;if(ka.sdp)la[aa]=ka.sdp;if(ka.ack_id)la[w]=ka.ack_id;this.$FBRTCLogger2(m,la);this.$FBRTCLogger1(ia,ja,'Sent',ka.type+', '+ka.msg_id);};ha.prototype.logSentMessageSuccess=function(ia,ja,ka,la){"use strict";var ma={};ma[ca]=ia;ma[x]=ja;ma[u]=ka;ma[v]=la;this.$FBRTCLogger2(o,ma);};ha.prototype.logSentMessageFailure=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[u]=ka;na[v]=la;na[da]=ma;this.$FBRTCLogger2(p,na);this.$FBRTCLogger1(ia,ja,'Send Failed',ka+', '+ma);};ha.prototype.logCallAction=function(ia,ja,ka,la,ma){"use strict";var na={};na[ca]=ia;na[x]=ja;na[r]=ka;na[aa]=la;if(ma)na[ea]=ma;this.$FBRTCLogger2(r,na);this.$FBRTCLogger1(ia,ja,'CallAction',ka+', '+la);};ha.prototype.logEvent=function(ia,ja,event){"use strict";var ka={};ka[ca]=ia;ka[x]=ja;ka[aa]=event;this.$FBRTCLogger2(s,ka);this.$FBRTCLogger1(ia,ja,'Event',event);};ha.prototype.logInfo=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(q,la);this.$FBRTCLogger1(ia,ja,'Info',ka);};ha.prototype.logError=function(ia,ja,ka){"use strict";var la={};la[ca]=ia;la[x]=ja;la[aa]=ka;this.$FBRTCLogger2(t,la);this.$FBRTCLogger1(ia,ja,'Error',ka);};ha.prototype.logErrorWithoutID=function(ia){"use strict";this.logError(null,null,ia);};ha.prototype.logEndCallSummary=function(ia){"use strict";if(!ia)return;var ja={};ja[ca]=ia.peerID;ja[x]=ia.callID;ja[ba]=fa;ja[aa]=ia.toString();var ka=ia.getExtraInfo();for(var la in ka)if(ka.hasOwnProperty(la))ja[la]=ka[la];this.$FBRTCLogger2(q,ja);this.$FBRTCLogger1(ia.peerID,ia.callID,'Call Summary',ja);};ha.prototype.$FBRTCLogger2=function(ia,ja){"use strict";ja.page_id=k;this.$FBRTCLogger0.log(ia,ja);i.log(ia,l,ja);};ha.prototype.$FBRTCLogger1=function(ia,ja,ka,la){"use strict";};ha.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ha.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown'};ha.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};e.exports=ha;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=5*60*1000,m={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};n.CURRENT_SUMMARY_VERSION=19;function n(o){"use strict";this.peerID=o.peerID;this.callID=o.callID;this.$FBRTCCallSummary0=o.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=k();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=this.$FBRTCCallSummaryg;this.$FBRTCCallSummaryk=0;this.$FBRTCCallSummaryl={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummarym());this.$FBRTCCallSummaryn();this.$FBRTCCallSummaryo=h.getInstance();this.$FBRTCCallSummaryp=i.getInstance();}n.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:n.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,callType:this.$FBRTCCallSummaryq,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryk,extraInfo:this.$FBRTCCallSummaryl,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryr()});};n.fromJsonString=function(o){"use strict";var p;try{p=JSON.parse(o);}catch(q){return null;}if(p.version!==n.CURRENT_SUMMARY_VERSION)return null;if(!p.hasOwnProperty('peerID')||!p.hasOwnProperty('callID')||!p.hasOwnProperty('isCaller')||!p.hasOwnProperty('startTime')||!p.hasOwnProperty('trigger')||!p.hasOwnProperty('signalingTime')||!p.hasOwnProperty('endCallReason')||!p.hasOwnProperty('isRemoteEnded')||!p.hasOwnProperty('lastUpdatedTime')||!p.hasOwnProperty('lastSerializedTime'))return null;var r=new n({peerID:p.peerID,callID:p.callID,isCaller:p.isCaller});r.$FBRTCCallSummary1=p.startTime;r.$FBRTCCallSummary2=p.trigger;r.$FBRTCCallSummary3=p.signalingTime;r.$FBRTCCallSummary4=p.endCallReason;r.$FBRTCCallSummary5=p.endCallSubreason;r.$FBRTCCallSummary6=p.isRemoteEnded;r.$FBRTCCallSummary7=p.lastUpdatedTime;r.$FBRTCCallSummary8=p.lastSerializedTime;if(p.callType)r.$FBRTCCallSummaryq=p.callType;if(p.unsetOnRetrieve)r.$FBRTCCallSummary9=p.unsetOnRetrieve;if(p.openCount)r.$FBRTCCallSummaryk=p.openCount;if(p.extraInfo)r.$FBRTCCallSummaryl=p.extraInfo;if(p.pcStats)r.$FBRTCCallSummarya=p.pcStats;if(p.captureStats)r.$FBRTCCallSummaryb=p.captureStats;if(p.gen0IceSentCount)r.$FBRTCCallSummaryc=p.gen0IceSentCount;if(p.gen0IceReceivedCount)r.$FBRTCCallSummaryd=p.gen0IceReceivedCount;if(p.iceSentCount)r.$FBRTCCallSummarye=p.iceSentCount;if(p.iceReceivedCount)r.$FBRTCCallSummaryf=p.iceReceivedCount;if(p.newSignalingTime)r.$FBRTCCallSummaryi=p.newSignalingTime;if(p.accumulatedCallTime)r.$FBRTCCallSummaryh=p.accumulatedCallTime;return r;};n.restoreOrInitialize=function(o,p,q,r,s){"use strict";var t=o.retrieveCallSummary(p,q);if(!t){t=new n({peerID:p,callID:q,isCaller:r});if(s){t.onFullMessageReceived({msg:s});t.onOfferAckSent(s);}else t.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(p,q,'Missing call summary from storage');}else if(t.$FBRTCCallSummary9){t.$FBRTCCallSummary4=null;t.$FBRTCCallSummary5=null;t.$FBRTCCallSummary6=null;delete t.$FBRTCCallSummary3[m.CALL_ENDED];delete t.$FBRTCCallSummaryi[m.CALL_ENDED];t.$FBRTCCallSummary9=null;}return t;};n.logSavedSummaries=function(o){"use strict";var p=o.getLoggableSummaries(),q=p.length;if(q<=0)return;var r=i.getInstance(),s=[];for(var t=0;t<q;t++){var u=p[t];r.logEndCallSummary(u);s.push({peerID:u.peerID,callID:u.callID});}o.removeCallSummaries(s);r.logToConsole('Logged pending summaries: '+q);};n.prototype.save=function(o){"use strict";var p=k(),q=p-this.$FBRTCCallSummaryj;if(q>l){this.$FBRTCCallSummaryp.logInfo(this.peerID,this.callID,'Summary too old: '+q);return;}o.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummaryj=p;};n.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};n.prototype.setLastUpdatedTime=function(o){"use strict";this.$FBRTCCallSummary7=o;};n.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryl;};n.prototype.addExtraInfo=function(o,p){"use strict";this.$FBRTCCallSummaryl[o]=p;this.$FBRTCCallSummaryn();};n.prototype.onCallStarted=function(o){"use strict";this.$FBRTCCallSummary2=o;this.$FBRTCCallSummarys(m.CALL_STARTED);this.$FBRTCCallSummaryn();};n.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummarys(m.POPUP_OPENED);this.$FBRTCCallSummaryk++;this.$FBRTCCallSummaryn();};n.prototype.setPcStats=function(o){"use strict";this.$FBRTCCallSummarya=o;this.$FBRTCCallSummaryn();};n.prototype.setVideoCaptureStats=function(o,p){"use strict";this.$FBRTCCallSummaryb={w:o,h:p};this.$FBRTCCallSummaryn();};n.prototype.setCallType=function(o){"use strict";this.$FBRTCCallSummaryq=o;};n.prototype.onOfferAckSent=function(o){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:o.flag});};n.prototype.onMessageSent=function(o){"use strict";var p=o.flag===1;switch(o.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryt(p,m.SENT_OFFER,m.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryu(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryt(p,m.SENT_ANSWER,m.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryu(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummarys(m.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummarys(m.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryt(p,m.SENT_OFFER_ACK,m.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryt(p,m.SENT_ANSWER_ACK,m.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryu(o,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummaryn();};n.prototype.$FBRTCCallSummaryu=function(o,p,q){"use strict";var r=null,s=null,t=this.$FBRTCCallSummaryo.extractIceInfo(o.sdp);for(var u=0;u<t.length;u++){r=t[u].gen;s=t[u].type;if(r===0)this.$FBRTCCallSummaryv(p,s);this.$FBRTCCallSummaryv(q,s);}};n.prototype.$FBRTCCallSummaryv=function(o,p){"use strict";if(!o[p]){o[p]=1;}else o[p]=o[p]+1;};n.prototype.$FBRTCCallSummaryw=function(o){"use strict";if(o.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};n.prototype.onFullMessageReceived=function(o){"use strict";var p=o.msg,q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryw(o);this.$FBRTCCallSummaryt(q,m.RECV_OFFER,m.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryu(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryw(o);this.$FBRTCCallSummaryt(q,m.RECV_ANSWER,m.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryu(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummarys(m.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummarys(m.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummaryt(q,m.RECV_OFFER_ACK,m.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummaryt(q,m.RECV_ANSWER_ACK,m.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryu(p,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummaryn();};n.prototype.onMsgAckReceived=function(o,p){"use strict";var q=o.msg.flag===1;if(p){this.$FBRTCCallSummaryt(q,m.RECV_OFFER_ACK,m.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummaryt(q,m.RECV_ANSWER_ACK,m.RECV_RETRIED_ANSWER_ACK);};n.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummarys(m.NETWORK_READY);this.$FBRTCCallSummarys(m.CALL_CONNECTED);this.$FBRTCCallSummaryn();};n.prototype.onCallEnded=function(o,p,q,r){"use strict";this.$FBRTCCallSummary9=q;this.$FBRTCCallSummary4=o;this.$FBRTCCallSummary5=r;this.$FBRTCCallSummary6=p;this.$FBRTCCallSummarys(m.CALL_ENDED);this.$FBRTCCallSummaryn();};n.prototype.toString=function(){"use strict";var o={};o.core_metrics=this.$FBRTCCallSummaryx();o.time_series=null;return JSON.stringify(o);};n.prototype.$FBRTCCallSummaryx=function(){"use strict";var o={};o.ver=n.CURRENT_SUMMARY_VERSION;o.caller=this.$FBRTCCallSummary0;o.call_type=this.$FBRTCCallSummaryq;o.conn=this.$FBRTCCallSummaryy();o.peer_id=this.peerID;o.has_video=true;o.open_count=this.$FBRTCCallSummaryk;o.signaling=this.$FBRTCCallSummaryz();o.sender=this.$FBRTCCallSummaryA();o.receiver=this.$FBRTCCallSummaryB();o.end=this.$FBRTCCallSummaryC();o.video=this.$FBRTCCallSummaryD();return o;};n.prototype.$FBRTCCallSummaryy=function(){"use strict";var o={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)o.rtt=this.$FBRTCCallSummarya.sender.rtt;return o;};n.prototype.$FBRTCCallSummaryz=function(){"use strict";var o={};if(this.$FBRTCCallSummary2)o.trigger=this.$FBRTCCallSummary2;o.start_time=this.$FBRTCCallSummary1;o.time_from_start=this.$FBRTCCallSummary3;var p=this.$FBRTCCallSummary3[m.CALL_CONNECTED],q=this.$FBRTCCallSummary3[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummary8){q=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else q=this.$FBRTCCallSummaryE();var r=q-p;if(r>0)o.duration=r;}o.new_time_from_start=this.$FBRTCCallSummaryi;p=this.$FBRTCCallSummaryi[m.CALL_CONNECTED];q=this.$FBRTCCallSummaryi[m.CALL_ENDED];if(p){if(!q)if(this.$FBRTCCallSummaryh>0){q=this.$FBRTCCallSummaryh;}else q=this.$FBRTCCallSummaryr();r=q-p;if(r>0)o.new_duration=r;}return o;};n.prototype.$FBRTCCallSummaryA=function(){"use strict";var o={};if(this.$FBRTCCallSummaryc)o.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)o.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)Object.assign(o,this.$FBRTCCallSummarya.sender);return o;};n.prototype.$FBRTCCallSummaryB=function(){"use strict";var o={};if(this.$FBRTCCallSummaryd)o.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)o.ice=this.$FBRTCCallSummaryf;return o;};n.prototype.$FBRTCCallSummaryC=function(){"use strict";var o={};if(this.$FBRTCCallSummary4!==null){o.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)o.end_call_subreason_string=this.$FBRTCCallSummary5;o.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)Object.assign(o,this.$FBRTCCallSummarya.end);return o;};n.prototype.$FBRTCCallSummaryD=function(){"use strict";var o={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)Object.assign(o,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)Object.assign(o.capture,this.$FBRTCCallSummaryb);return {sender:o};};n.prototype.$FBRTCCallSummaryE=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};n.prototype.$FBRTCCallSummaryr=function(){"use strict";var o=k()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+o);};n.prototype.$FBRTCCallSummarys=function(o){"use strict";if(this.$FBRTCCallSummary3[o])return;this.$FBRTCCallSummary3[o]=this.$FBRTCCallSummaryE();this.$FBRTCCallSummaryi[o]=this.$FBRTCCallSummaryr();};n.prototype.$FBRTCCallSummaryt=function(o,p,q){"use strict";if(o){this.$FBRTCCallSummarys(q);}else this.$FBRTCCallSummarys(p);};n.prototype.$FBRTCCallSummaryn=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};n.prototype.$FBRTCCallSummarym=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=n;},null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k='localstorage',l='RTC_CALL_SUMMARY_',m='summary',n=2000,o=3,p=3*60*1000,q=null;r.getInstance=function(){"use strict";if(!q)q=new r();return q;};function r(){"use strict";this.$FBRTCCallSummaryStore0=new g(k,l);this.$FBRTCCallSummaryStore1=i.getInstance();}r.prototype.storeCallSummary=function(s,t,u){"use strict";var v=this;this.$FBRTCCallSummaryStore2(function(w){if(!w[s])w[s]={};var x=w[s][t];if(x){var y=v.$FBRTCCallSummaryStore3(x);if(y&&y.getLastUpdatedTime()>u.getLastUpdatedTime()){v.$FBRTCCallSummaryStore1.logToConsole('Outdated summaries');return null;}}w[s][t]=v.$FBRTCCallSummaryStore4(u);return w;},v.$FBRTCCallSummaryStore1.logError.bind(v.$FBRTCCallSummaryStore1,s,t));};r.prototype.retrieveCallSummary=function(s,t){"use strict";var u=this.$FBRTCCallSummaryStore5(),v=null;if(u[s])v=u[s][t];if(v){return this.$FBRTCCallSummaryStore3(v);}else return null;};r.prototype.removeCallSummary=function(s,t){"use strict";this.removeCallSummaries([{peerID:s,callID:t}]);};r.prototype.removeCallSummaries=function(s){"use strict";var t=this;this.$FBRTCCallSummaryStore2(function(u){var v=s.length;for(var w=0;w<v;w++){var x=s[w].peerID,y=s[w].callID;if(u[x]&&u[x][y]){delete u[x][y];if(t.$FBRTCCallSummaryStore6(u[x]))delete u[x];}}return u;},t.$FBRTCCallSummaryStore1.logError.bind(t.$FBRTCCallSummaryStore1,null,null));};r.prototype.getLoggableSummaries=function(){"use strict";var s=this.$FBRTCCallSummaryStore5(),t=[];for(var u in s)if(s.hasOwnProperty(u))for(var v in s[u])if(s[u].hasOwnProperty(v)){var w=this.$FBRTCCallSummaryStore3(s[u][v],p);if(w)t.push(w);}return t;};r.prototype.$FBRTCCallSummaryStore6=function(s){"use strict";for(var t in s)if(s.hasOwnProperty(t))return false;return true;};r.prototype.$FBRTCCallSummaryStore4=function(s){"use strict";var t={__t:Date.now(),__d:s.toJsonString()};return t;};r.prototype.$FBRTCCallSummaryStore3=function(s,t){"use strict";if(s)if(!t||(Date.now()-s.__t>=t))return h.fromJsonString(s.__d);return null;};r.prototype.$FBRTCCallSummaryStore5=function(){"use strict";var s=this.$FBRTCCallSummaryStore0.get(m)||{};return s;};r.prototype.$FBRTCCallSummaryStore2=function(s,t,u,v){"use strict";if(u===(void 0)||u===null)u=o;var w=this.$FBRTCCallSummaryStore5(),x=this.$FBRTCCallSummaryStore5(),y=s(w);if(y===null)return;var z=this.$FBRTCCallSummaryStore5();if(j(x,z)){this.$FBRTCCallSummaryStore0.set(m,y);this.$FBRTCCallSummaryStore1.logToConsole('Updated summaries');}else if(u>0){t('Retry lock');if(v){var aa=this;setTimeout(function(){aa.$FBRTCCallSummaryStore2(s,t,u-1,true);},n);}else this.$FBRTCCallSummaryStore2(s,t,u-1,true);}else t('Failed to lock');};e.exports=r;},null);
__d("FBRTCUtils",["emptyFunction","randomInt","AsyncRequest"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=6000,k={attachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=window.webkitURL.createObjectURL(m);}else{l.mozSrcObject=m;l.play();}},reattachMediaStream:function(l,m){if(window.webkitRTCPeerConnection){l.src=m.src;}else{l.mozSrcObject=m.mozSrcObject;l.play();}},generateRandomInt:function(){return h(0,4294967294)+1;},aboutEqual:function(l,m){return (l-m)<.01&&(m-l)<.01;},sendServerRequest:function(l,m,n,o,p,q){m=m||g;n=n||g;o=o||false;p=p||j;q=q||{};var r=new i().setURI(l).setData(q).setAllowCrossPageTransition(true).setHandler(m).setErrorHandler(n).setTimeoutHandler(p,function(){n();});if(o)r.setOption('asynchronous',false);r.send();}};e.exports=k;},null);
__d("XVideoCallInitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("XVideoCallController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitController","XVideoCallController"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=3,l=function(p,q,r,s){g.getInstance().logCallAction(p,q,g.CallAction.OLD_URI);return j.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();},m=function(p,q,r,s,t,u,v){if(v===(void 0)||v===null)v=k;var w=i.getURIBuilder().setInt('peer_id',p).setInt('call_id',q).setBool('is_caller',r).setBool('audio_only',s).getURI();h.sendServerRequest(w,function(x){t(x.payload.uri);},function(x){if(v>0){m(p,q,r,s,t,u,v-1);}else t(l(p,q,r,s));});},n=function(p){window.history.replaceState({},'',p);},o={init:function(p){this._peerID=p;},onCallStarted:function(){n(l(this._peerID));},getCallUri:m};e.exports=o;},null);
__d("FBRTCCallUI",["BanzaiLogger","Cookie","UserAgent","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCUrlManager","pageID"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=null,q={openAsCaller:function(r,s,t,u){if(!p&&window.rtcCallChildWindow){p=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(r)){p.focus();return;}if(this._shouldCloseCallWindow())p.close();g.log('VideoCallLoggerConfig',{event:'open_as_caller'});m.getInstance().logCallAction(r,s,m.CallAction.START_CALL,null,t);var v=new j({peerID:r,callID:s,isCaller:true});v.onCallStarted(t);this._open(r,s,true,v,false,u);},openAsCallee:function(r,s,t,u,v){g.log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(r,s,false,t,u,v);},_shouldFocusCallWindow:function(r){return p&&!p.closed&&p.rtcCallInProgessWith===r;},_shouldCloseCallWindow:function(){return p&&!p.closed&&!p.rtcCallInProgessWith;},_open:function(r,s,t,u,v,w){h.clear('vcpwn');h.clear('vctid');var x=this._windowPosition(),y=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',x.height,x.width,x.top,x.left].join(',');if(this._isSparkBrowser())y='';u.addExtraInfo(m.Key.INITIATED_BY_PAGE_ID,o);u.onCallEnded(l.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');u.save(k.getInstance());g.log('VideoCallLoggerConfig',{event:'open_popup'});if(!v){p=window.open('','Video Call',y);this._setUri(p,r,s,t,w);}else{m.getInstance().logCallAction(r,s,m.CallAction.OPEN_POPUP);p=window.open(v,'Video Call',y);}if(window.focus)p.focus();},_setUri:function(r,s,t,u,v){n.getCallUri(s,t,u,v,function(w){m.getInstance().logCallAction(s,t,m.CallAction.OPEN_POPUP);r.location=w;},function(){m.getInstance().logCallAction(s,t,m.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var r=960,s=540,t,u,v,w;if(screen&&screen.width>1280){r=1280;s=720;}if(window.innerWidth!==(void 0)){u=window.innerWidth;t=window.innerHeight;}else{u=screen.width;t=screen.height;}if(window.screenLeft!==(void 0)){v=window.screenLeft;w=window.screenTop;}else{v=window.screenX;w=window.screenY;}var x=Math.floor(((u/2)-(r/2))+v),y=Math.floor(((t/2)-(s/2))+w);return {height:'height='+s.toString(),width:'width='+r.toString(),top:'top='+y.toString(),left:'left='+x.toString()};},_isSparkBrowser:function(){return i.isBrowser('Chrome < 34')&&i.isBrowser('Chrome > 33');}};e.exports=q;},null);
__d("FBRTCCore",["Bootloader","FBRTCAvailability","FBRTCCallUI","VideoCallSupport","invariant","randomInt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=false,n={startOutgoingCall:function(o,p,q){k(!isNaN(parseInt(o,10)));if(m)return;m=true;setTimeout(function(){m=false;},1000);if(j.isWebrtcSupported()){var r=this._generateCallID();i.openAsCaller(o,r,p,q);}else g.loadModules(["FBRTCUnsupportedBrowserMessage"],function(s){s.showForOutgoingCall();});},isAvailableForWebrtcCalling:function(o){return h.isCallable(o);},shouldEnableVideoCalling:function(){return j.isOSSupported();},_generateCallID:function(){return l(0,4294967295);}};e.exports=n;},null);
__d("FBRTCMessageListener",["Arbiter","ChannelConstants","invariant","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=[],l=null,m={init:function(){g.subscribe(h.getArbiterType('webrtc'),function(n,o){this._onMessage(o.obj);}.bind(this));},setMessageHandler:function(n,o){i(!l);l=o?n.bind(o):n;while(k.length)l(k.shift());},_onMessage:function(n){this.emit('messageReceived',n);if(l){l(n);}else k.push(n);}};j(m,{messageReceived:true});e.exports=m;},null);
__d("VideoCallCore",["Bootloader","FBRTCCallSummaryUploader","FBRTCCore","FBRTCLogger","FBRTCMessageListener","VideoCallSupport"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null,n={showOutgoingCallDialog:function(q,r,s){i.startOutgoingCall(q,s||j.Trigger.CHAT_TAB_ICON,r);}};function o(){if(!m)g.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(q,r,s,t){m=new q(r,t,(new s(n)));k.setMessageHandler(m.onMessageReceived,m);});}function p(q){return i.isAvailableForWebrtcCalling(q);}if(l.isReceiveWebrtcSupported()){h.init();k.init();k.once('messageReceived',function(q){o();});}e.exports=n;},null);
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatDispatcher","ChatConfig","ChatCookieInterface","ChatTabActions","InitialServerTime","LogHistory","JSLogger","MercuryAssert","MercuryLocalIDs","PresenceState","PresenceUtil","MercuryThreadIDMap","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=b('MercuryThreadIDMap').get(),v=b('MercuryThreads').get(),w=b('MercuryTimestampTracker').get(),x=n.serverTime,y=k.get('tab_max_load_age')||3600000,z=20,aa=o.getInstance('chat_tab_model'),ba={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function ca(xa){var ya=l.load(xa,ba);ya&&ga();return ya;}function da(xa,ya,za){var ab=ca(s.get());if(ya===(void 0)||ya>ba.lastChangeTime){if(xa()){ab=true;ba.lastChangeReason=za||null;fa(ya);}}else aa.error('rejected',{change_time:ya,state_time:ba.lastChangeTime});ab&&ea();}function ea(){if(ba.isInitialized)va.inform('change');}function fa(xa){if(xa===(void 0))xa=Math.max(w.getLastUserMessageTimestamp()||1,ba.lastChangeTime+1);ba.lastChangeTime=xa;s.doSync();}function ga(xa){var ya=ba.tabs.length-z;if(ya>0)ba.tabs=ba.tabs.filter(function(za){return za.raised||za.id==xa||ya--<=0;});if(ya>0)ba.tabs=ba.tabs.filter(function(za){return za.id==ba.promotedID||za.id==xa||ya--<=0;});}function ha(xa){for(var ya=0;ya<ba.tabs.length;ya++)if(ba.tabs[ya].id==xa)return ya;return -1;}function ia(xa,ya){var za=v.getThreadMetaNow(xa);if(!za)return false;if(za.is_canonical_user){return la(xa,ya);}else{var ab=ka(xa);if(ab)u.getFBIDFromClientID(xa,function(bb){if(oa(xa,bb)){fa();ea();}});return ab;}}function ja(xa){q.isThreadID(xa);if(ka(xa))ea();}function ka(xa){if(ha(xa)===-1){ba.tabs.push({id:xa,fragile:true});aa.log('open_fragile_tab',{tabs:JSON.stringify(ba.tabs),opened:xa,window_id:t.getSessionID()});return true;}return false;}function la(xa,ya){var za=ha(xa);if(za!=-1)if(ba.tabs[za].fragile){ba.tabs.splice(za,1);}else{ya&&(ba.tabs[za].signatureID=ya);return true;}for(var ab=0;ab<=ba.tabs.length;ab++)if(ab==ba.tabs.length||ba.tabs[ab].fragile){ba.tabs.splice(ab,0,{id:xa,signatureID:ya});ga(xa);aa.log('open_tab',{tabs:JSON.stringify(ba.tabs),opened:xa,window_id:t.getSessionID()});return true;}}function ma(xa,ya,za){q.isThreadID(xa);var ab=false;if(ba.localRaised&&ya){ba.localRaised[xa]=true;ab=true;}da(function(){if(ia(xa,za))ab=true;var bb=ha(xa);if(bb!=-1&&!ba.tabs[bb].raised){ba.tabs[bb].raised=true;ab=true;aa.log('raise_tab',{tabs:JSON.stringify(ba.tabs),raised:xa,window_id:t.getSessionID()});}return ab;});}function na(xa){if(ha(xa)!==-1&&ba.promotedID!==xa){ba.promotedID=xa;return true;}return false;}function oa(xa,ya){var za=ha(xa);if(za!=-1&&ba.tabs[za].fragile){var ab=ba.tabs[za];ab.fragile=false;ab.server_id=ya;var bb=[];ba.tabs.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);ba.tabs=bb;aa.log('make_permanent',{tabs:JSON.stringify(ba.tabs),tab_id:xa,window_id:t.getSessionID()});return true;}return false;}function pa(xa,ya){q.isThreadID(xa);var za=false;if(ba.localRaised){delete ba.localRaised[xa];za=true;}da(function(){if(qa(xa))za=true;return za;},(void 0),ya);}function qa(xa){var ya=ha(xa);if(xa==ba.promotedID)ba.promotedID=null;if(ya!=-1){ba.tabs.splice(ya,1);aa.log('close_tab',{tabs:JSON.stringify(ba.tabs),closed:xa,window_id:t.getSessionID()});return true;}return false;}function ra(){if(ba.tabs.length){aa.log('close_all_tabs',{closed_tabs:JSON.stringify(ba.tabs),window_id:t.getSessionID()});ba.tabs=[];ba.promotedID=null;if(ba.localRaised)ba.localRaised={};fa();ea();}}function sa(){var xa=[];for(var ya=0;ya<ba.tabs.length;ya++)if(ba.tabs[ya].fragile&&!v.isNewEmptyLocalThread(ba.tabs[ya].id)){xa.push(ba.tabs[ya]);ba.tabs.splice(ya);ea();break;}aa.log('close_fragile_tabs',{tabs:JSON.stringify(ba.tabs),fragile_closed:xa,window_id:t.getSessionID()});}function ta(xa){q.isThreadID(xa);var ya=false;if(ba.localRaised){delete ba.localRaised[xa];ya=true;}da(function(){var za=ha(xa);if(za!=-1&&ba.tabs[za].raised){delete ba.tabs[za].raised;aa.log('lower_tab',{tabs:JSON.stringify(ba.tabs),lowered:xa,window_id:t.getSessionID()});ya=true;}return ya;});}function ua(){if(ba.localRaised){da(function(){var xa=false;ba.tabs.forEach(function(ya){if(ya.raised!=ba.localRaised[ya.id]){xa=true;if(ba.localRaised[ya.id]){ya.raised=true;}else delete ya.raised;}});return xa;});aa.log('persist_local_raise',{tabs:JSON.stringify(ba.tabs),window_id:t.getSessionID()});}}s.registerStateStorer(function(xa){return l.store(xa,ba);});s.registerStateLoader(function(xa){if(ca(xa))ea();});function va(){}Object.assign(va,h,{isTabPromoted:function(xa){if(xa)return xa==ba.promotedID;return false;},indexOf:function(xa){return ha(xa);},getTab:function(xa){q.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=ba.tabs[ya];return Object.assign({},za);}return null;},getEmptyTab:function(){var xa;for(var ya=0;ya<ba.tabs.length;ya++){xa=ba.tabs[ya].id;if(v.isNewEmptyLocalThread(xa))return xa;}xa=r.generateThreadID();v.createNewLocalThread(xa,[]);return xa;},get:function(){var xa=ba.tabs.map(function(ya){var za=Object.assign({},ya);delete za.fragile;if(ba.localRaised)za.raised=ba.localRaised[za.id];return za;});return {tabs:xa,promoted:ba.promotedID};},promoteThreadInPlaceOfThread:function(xa,ya,za,ab){q.isThreadID(xa);q.isThreadID(ya);da(function(){var bb=ha(xa),cb=ha(ya);if(ab){ba.promotedID=xa;}else if(ba.promotedID===ya)return true;var db=ba.tabs[bb];if(za){q.isThreadID(za);var eb=ha(za),fb=ba.tabs[cb];ba.tabs[cb]=db;ba.tabs.splice(bb,1);ba.tabs.splice(eb,0,fb);}else{ba.tabs[bb]=ba.tabs[cb];ba.tabs[cb]=db;}return true;});},addListener:function(xa){return va.subscribe('change',xa);}});g.subscribe(p.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:ba.promotedID,tabs:ba.tabs.map(function(za){return Object.assign({},za);}),time:ba.lastChangeTime,max_load_age:y};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!ba.localRaised){aa.log('start_ignore_remote_raise');ba.localRaised={};ea();}else if(!xa&&ba.localRaised){aa.log('stop_ignore_remote_raise');ba.localRaised=null;ea();}}j.register(function(xa){switch(xa.actionType){case m.Types.CLOSE_TAB:pa(xa.threadID,xa.reason);break;case m.Types.CLOSE_ALL_TABS:ra();break;case m.Types.CLOSE_FRAGILE_TABS:sa();break;case m.Types.LOWER_TAB:ta(xa.threadID);break;case m.Types.OPEN_FRAGILE_TAB:ja(xa.threadID);break;case m.Types.OPEN_TAB:q.isThreadID(xa.threadID);da(function(){return ia(xa.threadID);});break;case m.Types.PERSIST_LOCAL_STATE:ua();break;case m.Types.PROMOTE_TAB:q.isThreadID(xa.threadID);da(na.bind(null,xa.threadID));break;case m.Types.RAISE_TAB:ma(xa.threadID,xa.userAction,xa.signatureID);break;}});i.subscribe(i.ON_CHANGED,wa);wa();ca(s.getInitial(),true);if(ba.lastChangeTime===0)ba.lastChangeTime=x-600000;ba.isInitialized=true;e.exports=va;},null);
__d("HotLikeSound",["MercuryConfig","SoundPlayer","StickerConstants"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';h.init(['audio/ogg','audio/mpeg']);var j=[g['sound.hot_like_grow_mp3_url'],g['sound.hot_like_grow_ogg_url']],k=[g['sound.hot_like_pop_mp3_url'],g['sound.hot_like_pop_ogg_url']],l=[g['sound.hot_like_outgoing_small_mp3_url'],g['sound.hot_like_outgoing_small_ogg_url']],m=[g['sound.hot_like_outgoing_medium_mp3_url'],g['sound.hot_like_outgoing_medium_ogg_url']],n=[g['sound.hot_like_outgoing_large_mp3_url'],g['sound.hot_like_outgoing_large_ogg_url']],o=function(){return false;},p={setCheckSoundEnabledFunc:function(q){o=q;},start:function(){this._play(j);},stop:function(){h.stop(j);},pop:function(){this.stop();this._play(k);},snap:function(q){this.stop();if(q===i.HOT_LIKE_SMALL_STICKER_ID)this._play(l);if(q===i.HOT_LIKE_MEDIUM_STICKER_ID)this._play(m);if(q===i.HOT_LIKE_LARGE_STICKER_ID)this._play(n);},_play:function(q){if(o())h.play(q);}};e.exports=p;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return (g._("Neue Nachricht"));}else return (g._("Keine Teilnehmer"));}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} und {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} und {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} und {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._({"*":"{others_count} weitere Personen"},[g.param("others_count",r,[0])]));}else return (g._("1 weitere Person"));}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=g.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});i.getMulti(r,function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=(p.showUnreadCount&&p.thread.unread_count)?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}.bind(this));},_renderTitleWithUnreadCount:function(p,q){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",p),l.param("unread-count",q)]));}});e.exports=o;},null);
__d("MercuryDelayedDispatcher",["MercuryDispatcher","MercuryServerRequests","MercurySingletonMixin","MercuryThreadIDMap"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';function k(l){this.$MercuryDelayedDispatcher0=l;this.$MercuryDelayedDispatcher1=[];this.$MercuryDelayedDispatcher2=j.getForFBID(this.$MercuryDelayedDispatcher0);this.$MercuryDelayedDispatcher3=g.getForFBID(this.$MercuryDelayedDispatcher0);this.$MercuryDelayedDispatcher4=h.getForFBID(this.$MercuryDelayedDispatcher0);this.$MercuryDelayedDispatcher3.subscribe('model-update-completed',function(m,n){return this.$MercuryDelayedDispatcher6();}.bind(this));}k.prototype.handleUpdateWaitForThread=function(l,m){var n=this.$MercuryDelayedDispatcher2.getClientIDFromFBIDNow(m);if(n){this.$MercuryDelayedDispatcher3.handleUpdate(l);return;}this.$MercuryDelayedDispatcher2.getClientIDFromFBID(m,function(){return this.$MercuryDelayedDispatcher1.push(l);}.bind(this));this.$MercuryDelayedDispatcher4.ensureThreadIsFetched(m);};k.prototype.$MercuryDelayedDispatcher6=function(){if(this.$MercuryDelayedDispatcher1&&this.$MercuryDelayedDispatcher1.length){var l=this.$MercuryDelayedDispatcher1[0];this.$MercuryDelayedDispatcher1=this.$MercuryDelayedDispatcher1.slice(1);this.$MercuryDelayedDispatcher3.handleUpdate(l);}};Object.assign(k,i);e.exports=k;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryDelayedDispatcher","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=v(o);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.__serverRequests=n.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler1=p.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=l.getForFBID(this.$MercuryChannelHandler0);this.__delayedDispatcher=j.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler4=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.message){s.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,offline_threading_id:ca.offline_threading_id,message_id:ca.mid,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[Object.assign({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=m.CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&q.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler6(this.__getMessagingPayloadType(),{obj:{event:r.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}s.addEntry('channel_receive','success',[da,ea.message_id,u.getSessionID()]);};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.other_user_fbid&&!ba.obj.thread_fbid))return;this.__serverRequests.handleUpdate({delivery_receipts:[{other_user_fbid:ba.obj.other_user_fbid||'',thread_fbid:ba.obj.thread_fbid||'',time:ba.obj.timestamp}]});};z.prototype.$MercuryChannelHandler6=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==r.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.__serverRequests.handleUpdate({actions:ca,payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.__serverRequests.handleUpdate({actions:ca,payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.__serverRequests.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:k.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.__serverRequests.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=m.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[Object.assign({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[Object.assign({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=m.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==r.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?t.SPAM:t.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[Object.assign({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==r.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?t.SPAM:t.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[Object.assign({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerd=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case t.ACTION_ARCHIVED:this.$MercuryChannelHandlerb(aa,ba);break;case t.INBOX:case t.OTHER:this.$MercuryChannelHandlerc(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.__serverRequests.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:t.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:t.INBOX}],payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerf(aa)||!ba.obj)return;this.$MercuryChannelHandler1.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=m.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.__delayedDispatcher.handleUpdateWaitForThread({actions:[Object.assign({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=m.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";var ca,da,ea=ba.obj.time,fa=ba.obj.reader,ga=ba.obj.thread_fbid||'';this.__serverRequests.handleUpdate({roger:(ca={},ca[ga]=(da={},da[fa]=ea,da),ca)});};z.prototype.$MercuryChannelHandlerh=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.is_message_blocked===(void 0)||!ba.obj.thread_fbid)return;var ca=i.UPDATE_BLOCKER_STATUS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,is_message_blocked:ba.obj.is_message_blocked}];this.__serverRequests.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandleri=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.got_blocked===(void 0)||!ba.obj.thread_fbid)return;var ca=i.UPDATE_BLOCKEE_STATUS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,got_blocked:ba.obj.got_blocked}];this.__serverRequests.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandlerj=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.__serverRequests.handleUpdate({actions:da,payload_source:m.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case r.DELIVER:this.$MercuryChannelHandler4(aa,ba);break;case r.DELIVERY_RECEIPT:this.$MercuryChannelHandler7(aa,ba);break;case r.READ:case r.UNREAD:this.$MercuryChannelHandler6(aa,ba);break;case r.READ_ALL:this.$MercuryChannelHandlera(aa,ba);break;case r.DELETE:this.$MercuryChannelHandler8(aa,ba);break;case r.DELETE_MESSAGES:this.$MercuryChannelHandler9(aa,ba);break;case r.TAG:this.$MercuryChannelHandlerd(aa,ba);break;case r.REPORT_SPAM:this.$MercuryChannelHandlerc(aa,ba);break;case r.READ_RECEIPT:this.$MercuryChannelHandlerg(aa,ba);break;case r.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerj(aa,ba);break;case r.UPDATE_BLOCKER_STATUS:this.$MercuryChannelHandlerh(aa,ba);break;case r.UPDATE_BLOCKEE_STATUS:this.$MercuryChannelHandleri(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler5=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlerf=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler3.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler3.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler3.length){this.$MercuryChannelHandler3.forEach(g.unsubscribe);this.$MercuryChannelHandler3=[];}return this;};Object.assign(z,o);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","MercuryDispatcher","MercurySingletonMixin","MercuryThreads","mixin","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=k.SUCCESS,r=o(h);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(x){"use strict";this.$MercuryRoger0={};this.$MercuryRoger1=[];this.$MercuryRoger2=x;this.$MercuryRoger3=l.getForFBID(this.$MercuryRoger2);this.$MercuryRoger4=n.getForFBID(this.$MercuryRoger2);this.$MercuryRoger3.subscribe('update-roger',function(y,z){for(var aa in z){var ba=this.$MercuryRoger0[aa]||i.OrderedMap();ba=ba.withMutations(function(ca){for(var da in z[aa]){var ea=this.$MercuryRoger4.getThreadMetaNow(aa);if(ea&&ea.participants)if(ea.participants.indexOf(da)==-1){this.$MercuryRoger1.push(w(this.$MercuryRoger0));continue;}var fa=ca.get(da),ga=z[aa][da];if(!fa||ga>fa)ca.set(da,ga);}}.bind(this));this.$MercuryRoger0[aa]=ba.sort();}z&&this.inform('change',z);}.bind(this));g.subscribe(j.DUMP_EVENT,function(y,z){z.bad_read_receipts={receipts:this.$MercuryRoger1};}.bind(this));}u.prototype.getSeenBy=function(x,y){"use strict";if(!x)return [];var z=[],aa=this.$MercuryRoger0[x.thread_id];if(!aa)return z;aa.forEach(function(ba,ca){if(v(x,ba,ca,y))z.push(ca);});return z;};u.prototype.wasSeenByAll=function(x){"use strict";if(!x)return false;var y=this.$MercuryRoger0[x.thread_id];if(!y)return false;return y.every(function(z,aa){return v(x,z,aa);});};u.prototype.getSeenTimestamps=function(x){"use strict";var y=this.$MercuryRoger0[x];if(!y){y=i.OrderedMap();this.$MercuryRoger0[x]=y;}return y;};u.prototype.getSeenTimestamp=function(x,y){"use strict";var z=this.$MercuryRoger0[x];return z?z.get(y):null;};Object.assign(u,m);function v(x,y,z,aa){return !!(y>x.timestamp&&(x.status===(void 0)||x.status===q)&&(!aa||z!=x.author));}function w(x){return p(x,function(y){return y.toJS();});}e.exports=u;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","setTimeoutAcrossTransitions","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=b('MercuryMessages').get(),m=b('MercuryRoger').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(y,z){if(q[y])return [];return m.getSeenBy(t(y),z);},wasSeenByAll:function(y){if(q[y])return false;return m.wasSeenByAll(t(y));}};Object.assign(s,g);function t(y){if(!p[y]){var z=o.getThreadMetaNow(y);if(z)p[y]={thread_id:y,author:z.participants[0],timestamp:z.timestamp};}return p[y];}function u(y){var z=false;l.getThreadMessagesRange(y,0,1,function(aa){var ba=aa[0];if(!ba)return;var ca=ba.timestamp;if(ba.action_id||ba.status==i.SUCCESS)ca-=h.getServerTimeOffset();var da=s.getSeenBy(y);if(q[y]){clearTimeout(q[y]);delete q[y];}var ea=ca+r,fa=ea-Date.now();if(fa>0)q[y]=k(function(){delete q[y];v(y);},fa);p[y]=ba;var ga=s.getSeenBy(y);if(da.length||ga.length)z=true;});return z;}function v(y){var z={};z[y]=true;w(z);}function w(y){s.inform('state-changed',y);s.inform('change');}function x(event,y){var z={};for(var aa in y)if(u(aa))z[aa]=true;for(var ba in z){w(z);break;}}m.subscribe('change',function(y,z){for(var aa in z)!q[aa]&&v(aa);});n.subscribe('messages-received',x);n.subscribe('messages-reordered',x);n.subscribe('messages-updated',x);e.exports=s;},null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=g.delivery_timeout||120000;function p(q){this.$MercuryDeliveryState0=q;this.$MercuryDeliveryState1=i.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState2=k.getForFBID(this.$MercuryDeliveryState0);this.$MercuryDeliveryState3=[];this.$MercuryDeliveryState2.subscribe('messages-received',this.$MercuryDeliveryState4.bind(this));m.subscribe(n(this.$MercuryDeliveryState5,300,this));}p.prototype.$MercuryDeliveryState4=function(q,r){for(var s in r){var t=r[s];t.forEach(function(u){if(this.$MercuryDeliveryState7(u))this.$MercuryDeliveryState3.push(u);}.bind(this));}if(m.isActive(o))this.$MercuryDeliveryState5();};p.prototype.$MercuryDeliveryState5=function(){if(this.$MercuryDeliveryState3.length===0)return;var q=this.$MercuryDeliveryState3.filter(this.$MercuryDeliveryState7,this).map(function(r){return r.message_id;});if(q)this.$MercuryDeliveryState1.sendDeliveryReceipts(q);this.$MercuryDeliveryState3=[];};p.prototype.$MercuryDeliveryState7=function(q){var r=q.author?h.getUserIDFromParticipantID(q.author):null;if(r===this.$MercuryDeliveryState0)return false;if(!q.is_unread)return false;if(!l.allows(r))return false;return true;};Object.assign(p,j);e.exports=p;},null);
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=[g.UNREAD],j={ALL:'all',UNREAD:g.UNREAD,getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;},null);
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionType","MercuryDispatcher","MercuryConfig","MercuryFilters","MercuryFolders","MercuryGlobalActionType","MercuryPayloadSource","MercurySingletonMixin","MercuryThreadIDMap","MessagingTag","PageMessageEnumTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x=g.getInstance('ordered_threadlist_model'),y=k.getSupportedFilters().concat([k.ALL,q.GROUPS]),z=l.getSupportedFolders();function aa(ka,la,ma,na){var oa=[],pa=false,qa=false,ra=(la||[]).filter(function(ya){var za=ya.filter||k.ALL;return (ya.folder==ma||(!ya.folder&&ma==q.INBOX))&&za==na;}),sa=ka._threadlistOrderMap[ma][na].getAllResources(),ta;ra.forEach(function(ya){oa=oa.concat(ya.thread_ids);if(ya.error){if(ya.end>sa.length)qa=ya.error;}else{var za=ya.end-ya.start;if(ya.thread_ids.length<za)pa=true;}if(!ta||ya.end>ta)ta=ya.end;});ea(ka,oa,ma,na);if(pa){ka._threadlistOrderMap[ma][na].setReachedEndOfArray();}else if(qa){ka._threadlistOrderMap[ma][na].setError(qa);}else{var ua=ka._threadlistOrderMap[ma][na].getCurrentArraySize();if(ta&&ua<ta){var va={},wa=sa.concat(oa),xa=wa.filter(function(ya){var za=va[ya];va[ya]=true;return za;});if(xa.length){x.warn('duplicate_threads',{folder:ma,expected_final_size:ta,actual_final_size:ua,duplicate_thread_ids:xa});ka._serverRequests.fetchThreadlistInfo(ta,xa.length,ma,na==k.ALL?null:na);}}}}function ba(ka,la){z.forEach(function(ma){y.forEach(function(na){aa(ka,la,ma,na);});});}function ca(ka,la){var ma={};z.forEach(function(na){ma[na]={};y.forEach(function(oa){ma[na][oa]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});la.forEach(function(na){if(na.is_forward)return;var oa=na.thread_id,pa=fa(ka,oa),qa=ga(ka,oa);function ra(){qa.forEach(function(ta){if(!w(y,ta))return;ma[pa][ta].to_add.push(oa);if(!ka._threadlistOrderMap[pa][ta].hasReachedEndOfArray()&&!ka._threadlistOrderMap[pa][ta].hasResource(oa))ma[pa][ta].to_remove_if_last_after_add[oa]=true;});}function sa(ta){if(w(y,ta))if(w(qa,ta)){ma[pa][ta].to_add.push(oa);}else ma[pa][ta].to_remove.push(oa);}if(!pa){if(na.action_type===h.CHANGE_FOLDER||na.action_type===h.CHANGE_ARCHIVED_STATUS)z.forEach(function(ta){if(ta!==pa)y.forEach(function(ua){ka._threadlistOrderMap[ta][ua].removeResources([oa]);});});return;}switch(na.action_type){case h.DELETE_THREAD:qa.forEach(function(ta){if(!w(y,ta))return;ma[pa][ta].to_remove.push(oa);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:ra();break;case h.CHANGE_READ_STATUS:sa(q.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:qa.forEach(function(ta){if(!w(y,ta))return;if(ha(ka,oa,pa,ta))ma[pa][ta].to_add.push(oa);});break;case h.CHANGE_FLAG:sa(r.FLAG);break;}});z.forEach(function(na){y.forEach(function(oa){var pa=ka._threadlistOrderMap[na][oa];ea(ka,ma[na][oa].to_add,na,oa);for(var qa=pa.getCurrentArraySize()-1;qa>=0;qa--){var ra=pa.getResourceAtIndex(qa);if(!ma[na][oa].to_remove_if_last_after_add[ra])break;ma[na][oa].to_remove.push(ra);}pa.removeResources(ma[na][oa].to_remove);});});}function da(ka,la){var ma={};z.forEach(function(na){ma[na]={};y.forEach(function(oa){ma[na][oa]=[];});});la.forEach(function(na){var oa=fa(ka,na.thread_id),pa=ga(ka,na.thread_id);if(oa)pa.forEach(function(qa){if(ha(ka,na.thread_id,oa,qa))ma[oa][qa].push(na.thread_id);});});z.forEach(function(na){y.forEach(function(oa){if(ma[na][oa].length>0)ea(ka,ma[na][oa],na,oa);});});}function ea(ka,la,ma,na){na=na||k.ALL;ka._threadlistOrderMap[ma][na].addResources(la);z.forEach(function(oa){if(oa!=ma)ka._threadlistOrderMap[oa][na].removeResources(la);});}function fa(ka,la){var ma=ka._threads.getThreadMetaNow(la),na=null;if(!ma){na='No thread metadata';}else if(!ma.folder)na='No thread folder';if(na){var oa={error:na,tid:la};x.warn('no_thread_folder',oa);return null;}var pa=ma.folder;if(ma.is_archived)pa=q.ACTION_ARCHIVED;if(ka._threadlistOrderMap[pa]){return pa;}else return null;}function ga(ka,la){var ma=ka._threads.getThreadMetaNow(la),na=[k.ALL];if(!ma){var oa={error:'no_thread_metadata',tid:la};x.warn('no_thread_metadata',oa);return [];}if(ma.unread_count)na.push(q.UNREAD);if(!ma.is_canonical)na.push(q.GROUPS);var pa=ma.page_thread_info;if(pa&&pa.flagged)na.push(r.FLAG);return na;}function ha(ka,la,ma,na){var oa=ka._threads.getThreadMetaNow(la);return oa&&oa.timestamp&&fa(ka,la)==ma&&w(ga(ka,la),na);}function ia(ka){this._fbid=ka;this._serverRequests=t.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threadInformer=u.getForFBID(this._fbid);this._threads=v.getForFBID(this._fbid);this._dispatcher=i.getForFBID(this._fbid);this._threadlistOrderMap={};z.forEach(function(la){this._threadlistOrderMap[la]={};y.forEach(function(ma){this._threadlistOrderMap[la][ma]=new s(function(na){return this._threads.getThreadMetaNow(na).timestamp;}.bind(this),function(na,oa){return oa-na;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}.bind(this));this._dispatcher.subscribe('update-threadlist',function(la,ma){if(!ja(ma))return;if(j.MessengerJewelUnread!=='none')if(ma.global_actions)ma.global_actions.forEach(function(pa){if(pa.action_type==m.MARK_ALL_READ)this.getThreadlistOrderMap(pa.folder,k.UNREAD).removeAllResources();}.bind(this));var na=ma.ordered_threadlists;if(na&&na.length){ba(this,na);}else{var oa=(ma.actions||[]).filter(function(pa){return pa.thread_id;});da(this,ma.threads||[]);ca(this,oa);}this._threadInformer.updatedThreadlist();}.bind(this));}Object.assign(ia.prototype,{getThreadlistOrderMap:function(ka,la){if(!this._threadlistOrderMap[ka][la]){y=y.concat([la]);z.forEach(function(ma){this._threadlistOrderMap[ma][la]=new s(function(na){return this._threads.getThreadMetaNow(na).timestamp;}.bind(this),function(na,oa){return oa-na;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}.bind(this));}return this._threadlistOrderMap[ka][la];},getThreadlist:function(ka,la,ma,na,oa,pa){return this.getFilteredThreadlist(ka,la,ma,k.ALL,na,oa,pa);},getFilteredThreadlist:function(ka,la,ma,na,oa,pa,qa){var ra=this.getThreadlistOrderMap(ma,na),sa=ra.executeOrEnqueue(ka,la,oa,pa),ta=ra.getUnavailableResources(sa),ua=ra.getError(ka,la,pa);if(ta.length||ua){if(ra.getCurrentArraySize()<ka){var va={start:ka,limit:la,filter:na,resources_size:ra.getCurrentArraySize()};x.warn('range_with_gap',va);}ra.setError(false);this._serverRequests.fetchThreadlistInfo(ra.getCurrentArraySize(),ta.length,ma,na==k.ALL?null:na,qa);}return sa;},getThreadlistUntilTimestamp:function(ka,la,ma){ma=ma||k.ALL;return this.getThreadlistOrderMap(la,ma).getElementsUntil(ka);},getAvailableThreadlistNow:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getAllResources();},getThreadCount:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).getCurrentArraySize();},hasLoadedThreadlist:function(ka,la){la=la||k.ALL;return this.getThreadlistOrderMap(ka,la).hasReachedEndOfArray();},unsubscribe:function(ka,la,ma){ma=ma||k.ALL;this.getThreadlistOrderMap(la,ma).unsubscribe(ka);}});Object.assign(ia,o);function ja(ka){switch(ka.payload_source){case n.CLIENT_CHANGE_ARCHIVED_STATUS:case n.CLIENT_CHANGE_READ_STATUS:case n.CLIENT_CHANGE_FOLDER:case n.CLIENT_CHANNEL_MESSAGE:case n.CLIENT_DELETE_MESSAGES:case n.CLIENT_DELETE_THREAD:case n.CLIENT_SEND_MESSAGE:case n.SERVER_SEND_MESSAGE:case n.SERVER_CONFIRM_MESSAGES:case n.SERVER_FETCH_THREADLIST_INFO:case n.SERVER_THREAD_SYNC:return true;case n.SERVER_INITIAL_DATA:return ka.ordered_threadlists;default:return false;}}e.exports=ia;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","LogHistory","MercuryAPIArgsSource","MercuryFolders","MercuryOrderedThreadlist","MercuryServerRequests","MercurySingletonMixin","MessagingTag","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=i.getInstance('mercury_state_check');function r(s){"use strict";this.$MercuryStateCheck0=s;this.$MercuryStateCheck1=m.getForFBID(this.$MercuryStateCheck0);this.$MercuryStateCheck2=l.getForFBID(this.$MercuryStateCheck0);g.subscribe(h.ON_INVALID_HISTORY,this.$MercuryStateCheck3.bind(this,h.ON_INVALID_HISTORY));d(['ChannelConnection'],function(t){t.subscribe(t.CONNECTED,function(u,v){if(!v.init)this.$MercuryStateCheck4(t.CONNECTED);}.bind(this));}.bind(this));}r.prototype.$MercuryStateCheck3=function(s){"use strict";var t;if(p.getRequestURI().getPath().search(/messages/)!==-1){t=k.getSupportedFolders();}else t=[o.INBOX];q.debug('check',{folders:t,source:s});this.$MercuryStateCheck1.fetchMissedMessages(t,j.MERCURYSYNC);};r.prototype.$MercuryStateCheck4=function(s){"use strict";var t=this.$MercuryStateCheck2.getAvailableThreadlistNow(o.INBOX)||[];t=t.slice(0,20);q.debug('full_check',{threads:t,source:s});this.$MercuryStateCheck1.fetchThreadData(t,j.MERCURYSYNC);this.$MercuryStateCheck3(s);};Object.assign(r,n);e.exports=r;},null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionType","MercuryDispatcher","MercurySingletonMixin","MercuryThreadInfo","MercuryThreadlistConstants","MercuryThreadIDMap","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=n.MAX_UNSEEN_COUNT,w='unseen_thread_hash',x='unseen_thread_list',y=i.getInstance('mercury_unseen_state');function z(oa){this._fbid=oa;this._serverRequests=q.getForFBID(this._fbid);this._threadIDMap=o.getForFBID(this._fbid);this._threads=s.getForFBID(this._fbid);this._threadInformer=r.getForFBID(this._fbid);this._dispatcher=k.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new h();this._dispatcher.subscribe('update-unseen',function(pa,qa){fa(this,qa);}.bind(this));this._dispatcher.subscribe('update-thread-ids',function(pa,qa){la(this,qa);}.bind(this));}Object.assign(z.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){y.error('unguarded_unseen_count_fetch',{});return 0;}return ea(this)||0;},exceedsMaxCount:function(){return this._maxCount||(ea(this)>v);},markAsSeen:function(){var oa=ea(this);if(oa===null){this._pendingServerUpdates=true;}else if(oa>0||this._maxCount){this._serverRequests.markSeen();var pa=this._serverRequests.getLastActionTimestamp();ga(this,pa,[]);}}});Object.assign(z,l);function aa(oa,pa,qa){var ra={};ra[pa]=0;ia(oa,ra,qa);}function ba(oa,pa){oa._unseenResources.setResource(w,pa);oa._unseenResources.setResource(x,Object.keys(pa));}function ca(oa,pa){var qa=oa._unseenResources.executeOrEnqueue(w,pa),ra=oa._unseenResources.getUnavailableResources(qa);if(ra.length)oa._serverRequests.fetchUnseenThreadIDs();}function da(oa){return oa._unseenResources.getResource(w);}function ea(oa){var pa=oa._unseenResources.getResource(x);if(pa){return pa.length;}else return oa._initialUnseenCount;}function fa(oa,pa){var qa=na(pa);if(pa.unseen_thread_fbids){pa.unseen_thread_fbids.forEach(function(bb){if(bb.folder!=p.INBOX)return;var cb=bb.thread_fbids||[];cb=cb.concat(bb.other_user_fbids||[]);var db=ka(oa,cb),eb=oa._lastSeenTimestamp;if(qa&&qa.seen_timestamp)eb=qa.seen_timestamp;ga(oa,eb,db);if(qa&&qa.unseen_count>v)oa._maxCount=true;});}else if(qa&&qa.seen_timestamp){oa._lastSeenTimestamp=qa.seen_timestamp;if(qa.unseen_count>v){oa._maxCount=true;ba(oa,{});}else{oa._initialUnseenCount=qa.unseen_count;if(oa._initialUnseenCount===0)ba(oa,{});}}else{if(oa._maxCount)return;var ra=pa.actions;if(!ra||!(ra.length))return;var sa={},ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];if(va.is_forward)continue;var wa=va.action_type,xa=va.other_user_fbid?va.other_user_fbid:va.thread_fbid,ya=va.thread_id?va.thread_id:xa;if(wa==j.MARK_THREAD_SEEN){aa(oa,ya,va.persistent);continue;}if(!ma(oa,va))continue;if(wa==j.USER_GENERATED_MESSAGE||wa==j.LOG_MESSAGE){var za=sa[ya]?va.timestamp>sa[ya]:false,ab=za||!sa[ya];if(va.is_unread&&ab)oa._threads.getThreadMeta(ya,function(bb){var cb=false;if(bb&&bb.last_read_timestamp)if(bb.last_read_timestamp>=va.timestamp)cb=true;if(!m.isMuted(bb)&&!cb)sa[ya]=va.timestamp;});}else if(wa==j.CHANGE_READ_STATUS&&va.mark_as_read)ta[ya]=va.timestamp;}ha(oa,sa);ia(oa,ta);}if(oa._pendingServerUpdates){oa._pendingServerUpdates=false;oa.markAsSeen();}}function ga(oa,pa,qa){var ra=da(oa);if(ra===(void 0)||pa>oa._lastSeenTimestamp||oa._maxCount){oa._lastSeenTimestamp=pa;qa=qa||[];if(qa.length<=v)oa._maxCount=false;var sa={},ta=da(oa)||{};for(var ua in ta)if(ta[ua]!==true){var va=ta[ua];if(ja(oa,va))sa[ua]=va;}var wa=Object.assign(t(qa,true),sa);ba(oa,wa);oa._threadInformer.updatedUnseenState();}}function ha(oa,pa){if(oa._maxCount)return;var qa={},ra=false;for(var sa in pa){var ta=pa[sa];if(ja(oa,ta)){qa[sa]=ta;ra=true;}}if(!ra)return;ca(oa,function(ua){for(var va in qa){var wa=qa[va];if(!ua[va]&&ja(oa,wa))ua[va]=qa[va];}ba(oa,ua);oa._threadInformer.updatedUnseenState();});}function ia(oa,pa,qa){var ra=false;if(!u(pa))ra=true;if(ra)ca(oa,function(sa){var ta=false;for(var ua in pa){var va=pa[ua],wa=va>sa[ua];if(sa[ua]&&(!va||wa)){delete sa[ua];ta=true;}}if(ta){ba(oa,sa);oa._threadInformer.updatedUnseenState();if(qa&&ea(oa)===0)oa._serverRequests.markSeen();}});}function ja(oa,pa){return pa>oa._lastSeenTimestamp;}function ka(oa,pa){return pa.map(oa._threadIDMap.convertThreadIDIfAvailable,oa._threadIDMap);}function la(oa,pa){var qa=da(oa);if(!qa)return;for(var ra in pa){var sa=pa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}ba(oa,qa);}function ma(oa,pa){var qa=pa.thread_id?oa._threads.getThreadMetaNow(pa.thread_id):null,ra=qa?g.getFromMeta(qa):pa.folder;return ra===p.INBOX||ra===(void 0);}function na(oa){var pa=(oa.message_counts||[]);for(var qa=0;qa<pa.length;qa++)if(pa[qa].folder==p.INBOX)return pa[qa];return null;}e.exports=z;},null);